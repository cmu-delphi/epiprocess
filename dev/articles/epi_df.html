<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with epi_df objects and time series data • epiprocess</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Serif_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with epi_df objects and time series data">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epiprocess</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.11.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/epiprocess.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/epi_df.html">Working with epi_df objects and time series data</a></li>
    <li><a class="dropdown-item" href="../articles/epi_archive.html">Working with epi_archive objects and data revisions</a></li>
    <li><a class="dropdown-item" href="../articles/outliers.html">Detect and correct outliers in signals</a></li>
    <li><a class="dropdown-item" href="../articles/growth_rate.html">Estimate growth rates in signals</a></li>
    <li><a class="dropdown-item" href="../articles/correlation.html">Correlate signals across locations and time</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cmu-delphi/epiprocess/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Working with epi_df objects and time series data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epiprocess/blob/dev/vignettes/epi_df.Rmd" class="external-link"><code>vignettes/epi_df.Rmd</code></a></small>
      <div class="d-none name"><code>epi_df.Rmd</code></div>
    </div>

    
    
<p>The <code>epi_df</code> data structure provided by
<code>epiprocess</code> provides convenient ways to perform common
processing tasks. In this vignette, we will:</p>
<ul>
<li>construct an <code>epi_df</code> from a data frame</li>
<li>perform rolling time-window computations using
<code><a href="../reference/epi_slide.html">epi_slide()</a></code>
</li>
<li>perform group-level aggregation using
<code><a href="../reference/sum_groups_epi_df.html">sum_groups_epi_df()</a></code>
</li>
<li>detect and fill time gaps using <code><a href="../reference/complete.epi_df.html">complete.epi_df()</a></code> and
<a href="https://tsibble.tidyverts.org" class="external-link">tsibble</a>
</li>
<li>perform geographic aggregation (not yet implemented)</li>
</ul>
<div class="section level2">
<h2 id="getting-data-into-epi_df-format">Getting data into <code>epi_df</code> format<a class="anchor" aria-label="anchor" href="#getting-data-into-epi_df-format"></a>
</h2>
<p>As in <code><a href="../articles/epiprocess.html">vignette("epiprocess")</a></code>, we will fetch daily
reported COVID-19 cases from CA, FL, NY, and TX (note: here we’re using
new, not cumulative cases) using the <a href="https://github.com/cmu-delphi/epidatr" class="external-link"><code>epidatr</code></a>
package, and then convert this to <code>epi_df</code> format.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cmu-delphi/epiprocess" class="external-link">epiprocess</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>The data is included in the <a href="https://cmu-delphi.github.io/epidatasets/" class="external-link"><code>epidatasets</code>
package</a>, which is loaded along with <code>epiprocess</code>, and can
be accessed with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edf</span> <span class="op">&lt;-</span> <span class="va">cases_deaths_subset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span>, <span class="va">cases</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span><span class="op">)</span></span></code></pre></div>
<p>The data can also be fetched from the Delphi Epidata API with the
following query:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cmu-delphi.github.io/epidatr/" class="external-link">epidatr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-03-20"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cmu-delphi.github.io/epidatr/reference/pub_covidcast.html" class="external-link">pub_covidcast</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"jhu-csse"</span>,</span>
<span>  signals <span class="op">=</span> <span class="st">"confirmed_incidence_num"</span>,</span>
<span>  geo_type <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  time_type <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>  geo_values <span class="op">=</span> <span class="st">"ca,fl,ny,tx,ga,pa"</span>,</span>
<span>  time_values <span class="op">=</span> <span class="fu"><a href="https://cmu-delphi.github.io/epidatr/reference/epirange.html" class="external-link">epirange</a></span><span class="op">(</span><span class="fl">20200301</span>, <span class="fl">20211231</span><span class="op">)</span>,</span>
<span>  as_of <span class="op">=</span> <span class="va">d</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span>, cases <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/epi_df.html">as_epi_df</a></span><span class="op">(</span>as_of <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p>The data has 2,684 rows and 3 columns.</p>
</div>
<div class="section level2">
<h2 id="rolling-computations-using-epi_slide">Rolling computations using <code>epi_slide</code><a class="anchor" aria-label="anchor" href="#rolling-computations-using-epi_slide"></a>
</h2>
<p>A very common operation in time series processing is aggregating the
values of the time series by applying some function on a rolling time
window of data points. The key tool that allows this is
<code><a href="../reference/epi_slide.html">epi_slide()</a></code>. The function always first makes sure to group
the data by the grouping variables of the <code>epi_df</code> object,
which includes the <code>geo_value</code> and possibly
<code>other_keys</code> columns. It then applies the rolling slide
computation inside each group.</p>
<p>The <code><a href="../reference/epi_slide.html">epi_slide()</a></code> function has three ways to specify the
computation to be performed:</p>
<ul>
<li>by using a tidy evaluation approach</li>
<li>by passing a formula</li>
<li>by passing a function</li>
</ul>
<div class="section level3">
<h3 id="slide-the-tidy-way">Slide the tidy way<a class="anchor" aria-label="anchor" href="#slide-the-tidy-way"></a>
</h3>
<p>Usually, the most convenient way to setup a computation in
<code><a href="../reference/epi_slide.html">epi_slide()</a></code> is to pass in an expression for tidy
evaluation. In this case, we can simply define the name of the new
column directly as part of the expression, setting it equal to a
computation in which we can access any columns of <code>.x</code> by
name, just as we would in a call to, say, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code>.
For example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slide_output</span> <span class="op">&lt;-</span> <span class="va">edf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/epi_slide.html">epi_slide</a></span><span class="op">(</span>cases_7sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">cases</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, .window_size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p>As a simple sanity check, we visualize the 7-day trailing averages
computed on top of the original counts:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">slide_output</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">cases</span>, fill <span class="op">=</span> <span class="va">geo_value</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">cases_7sd</span>, col <span class="op">=</span> <span class="va">geo_value</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">geo_value</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>minor_breaks <span class="op">=</span> <span class="st">"month"</span>, date_labels <span class="op">=</span> <span class="st">"%b %y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Reported COVID-19 cases"</span><span class="op">)</span></span></code></pre></div>
<p><img src="epi_df_files/figure-html/unnamed-chunk-6-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>As we can see from the Texas plot, the state moved to weekly
reporting of COVID-19 cases in summer of 2021.</p>
<p>Note that without <code><a href="../reference/epi_slide.html">epi_slide()</a></code>, the computation is much
less convenient. For instance, a rough equivalent of the above
computation would be the following, which is easy to get wrong:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span><span class="va">geo_value</span>, time_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">time_value</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">time_value</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/arrange_canonical.html">arrange_canonical</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cases_7sd <span class="op">=</span> <span class="fu">slider</span><span class="fu">::</span><span class="fu"><a href="https://slider.r-lib.org/reference/slide.html" class="external-link">slide_dbl</a></span><span class="op">(</span><span class="va">cases</span>, .f <span class="op">=</span> <span class="va">sd</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, .before <span class="op">=</span> <span class="fl">7</span>, .after <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; An `epi_df` object, 4,026 x 4 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2024-03-20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,026 × 4</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span> <span style="font-weight: bold;">cases_7sd</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ca        2020-03-01     6     <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ca        2020-03-02     4      1.41</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ca        2020-03-03     6      1.15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ca        2020-03-04    11      2.99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ca        2020-03-05    10      2.97</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ca        2020-03-06    18      5.08</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,020 more rows</span></span></span></code></pre></div>
<p>Furthermore <code><a href="../reference/epi_slide.html">epi_slide()</a></code> allows for selecting
<code>.ref_time_value</code>, which the latter recipe does not
support.</p>
</div>
<div class="section level3">
<h3 id="slide-with-a-function">Slide with a function<a class="anchor" aria-label="anchor" href="#slide-with-a-function"></a>
</h3>
<p>We can also pass a function to the second argument in
<code><a href="../reference/epi_slide.html">epi_slide()</a></code>. In this case, the passed function
<code>.f</code> must have the form <code>function(x, g, t, ...)</code>,
where</p>
<ul>
<li>
<code>x</code> is an epi_df with the same column names as the input
epi_df</li>
<li>
<code>g</code> is a one-row tibble containing the values of the
grouping variables for the associated group, for instance
<code>g$geo_value</code>
</li>
<li>
<code>t</code> is the ref_time_value for the current window</li>
<li>
<code>...</code> (optional) are any additional arguments you’d like
to be able to forward to your function</li>
</ul>
<p>The same computation as above can be done with a function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/epi_slide.html">epi_slide</a></span><span class="op">(</span>.f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">g</span>, <span class="va">t</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">cases</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, .window_size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt; An `epi_df` object, 4,026 x 4 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2024-03-20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,026 × 4</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span> <span style="font-weight: bold;">slide_value</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ca        2020-03-01     6       <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ca        2020-03-02     4        1.41</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ca        2020-03-03     6        1.15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ca        2020-03-04    11        2.99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ca        2020-03-05    10        2.97</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ca        2020-03-06    18        5.08</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,020 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="epi_slide-with-a-formula">
<code>epi_slide()</code> with a formula<a class="anchor" aria-label="anchor" href="#epi_slide-with-a-formula"></a>
</h3>
<p>The same computation as above can be done with a formula, where all
references to the columns must be made with the prefix
<code>.x$...</code>, for instance:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/epi_slide.html">epi_slide</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">cases</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, .window_size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt; An `epi_df` object, 4,026 x 4 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2024-03-20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,026 × 4</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span> <span style="font-weight: bold;">slide_value</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ca        2020-03-01     6       <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ca        2020-03-02     4        1.41</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ca        2020-03-03     6        1.15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ca        2020-03-04    11        2.99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ca        2020-03-05    10        2.97</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ca        2020-03-06    18        5.08</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,020 more rows</span></span></span></code></pre></div>
<p>Note that the name of the column defaults to <code>slide_value</code>
in the unnamed formula or function case. This can be adjusted with
<code>.new_col_name</code>.</p>
</div>
<div class="section level3">
<h3 id="rolling-computations-with-multiple-column-outputs">Rolling computations with multiple column outputs<a class="anchor" aria-label="anchor" href="#rolling-computations-with-multiple-column-outputs"></a>
</h3>
<p>If your formula (or function) returns a tibble (or other kind of data
frame), then its columns will be unpacked into the resulting
<code>epi_df</code> (in the sense of <code><a href="https://tidyr.tidyverse.org/reference/pack.html" class="external-link">tidyr::unpack()</a></code>). For
example, the following computes the 7-day trailing average of daily
cases as well as the the 7-day trailing standard deviation of daily
cases:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/epi_slide.html">epi_slide</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      cases_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">cases</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      cases_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">cases</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    .window_size <span class="op">=</span> <span class="fl">7</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; An `epi_df` object, 4,026 x 5 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2024-03-20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,026 × 5</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span> <span style="font-weight: bold;">cases_mean</span> <span style="font-weight: bold;">cases_sd</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ca        2020-03-01     6       6       <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ca        2020-03-02     4       5        1.41</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ca        2020-03-03     6       5.33     1.15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ca        2020-03-04    11       6.75     2.99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ca        2020-03-05    10       7.4      2.97</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ca        2020-03-06    18       9.17     5.08</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,020 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="optimized-rolling-mean-and-sums">Optimized rolling mean and sums<a class="anchor" aria-label="anchor" href="#optimized-rolling-mean-and-sums"></a>
</h3>
<p>For the two most common sliding operations, we offer two optimized
versions: <code><a href="../reference/epi_slide_opt.html">epi_slide_mean()</a></code> and
<code><a href="../reference/epi_slide_opt.html">epi_slide_sum()</a></code>. These are much faster than
<code><a href="../reference/epi_slide.html">epi_slide()</a></code>, so we recommend using them when you are only
interested in the mean or sum of a column. The following computes the
7-day trailing mean of daily cases, allowing means and sums to be taken
over fewer than 7 observations if there is missingness
(<code>na.rm = TRUE</code>):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/epi_slide_opt.html">epi_slide_mean</a></span><span class="op">(</span><span class="st">"cases"</span>, .window_size <span class="op">=</span> <span class="fl">7</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; An `epi_df` object, 4,026 x 4 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2024-03-20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,026 × 4</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span> <span style="font-weight: bold;">cases_7dav</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ca        2020-03-01     6       6   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ca        2020-03-02     4       5   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ca        2020-03-03     6       5.33</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ca        2020-03-04    11       6.75</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ca        2020-03-05    10       7.4 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ca        2020-03-06    18       9.17</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,020 more rows</span></span></span>
<span><span class="va">edf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/epi_slide_opt.html">epi_slide_sum</a></span><span class="op">(</span><span class="st">"cases"</span>, .window_size <span class="op">=</span> <span class="fl">7</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; An `epi_df` object, 4,026 x 4 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2024-03-20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,026 × 4</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span> <span style="font-weight: bold;">cases_7dsum</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ca        2020-03-01     6           6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ca        2020-03-02     4          10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ca        2020-03-03     6          16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ca        2020-03-04    11          27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ca        2020-03-05    10          37</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ca        2020-03-06    18          55</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,020 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-a-forecaster-on-a-sliding-window-of-data">Running a forecaster on a sliding window of data<a class="anchor" aria-label="anchor" href="#running-a-forecaster-on-a-sliding-window-of-data"></a>
</h3>
<p>The natural next step is to use the sliding window to forecast future
values. However to do this correctly, we should make sure that our data
is historically accurate. The data structure we use for that is the
<code>epi_archive</code> and the analogous slide function is
<code><a href="../reference/epix_slide.html">epix_slide()</a></code>. To read further along this train of thought,
see <code><a href="../articles/epi_archive.html">vignette("epi_archive")</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="adding-more-keys-to-an-epi_df-and-aggregating-groups-with-sum_groups_epi_df">Adding more keys to an <code>epi_df</code> and aggregating groups
with <code>sum_groups_epi_df</code><a class="anchor" aria-label="anchor" href="#adding-more-keys-to-an-epi_df-and-aggregating-groups-with-sum_groups_epi_df"></a>
</h2>
<p>An <code>epi_df</code> object can have more key columns than just
<code>geo_value</code> and <code>time_value</code>. For example, if we
have demographic attributes like age group, we can add this as a key
column. We can then aggregate the data by these key columns using
<code><a href="../reference/sum_groups_epi_df.html">sum_groups_epi_df()</a></code>. Let’s use influenza hospitalization
rate data from the CDC system FluSurv as an example. We can get it from
the <a href="https://cmu-delphi.github.io/delphi-epidata/api/flusurv.html" class="external-link">Delphi
Epidata API</a>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cmu-delphi.github.io/epidatr/" class="external-link">epidatr</a></span><span class="op">)</span></span>
<span><span class="va">flu_data_api</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cmu-delphi.github.io/epidatr/reference/pub_flusurv.html" class="external-link">pub_flusurv</a></span><span class="op">(</span></span>
<span>  locations <span class="op">=</span> <span class="st">"ca"</span>,</span>
<span>  epiweeks <span class="op">=</span> <span class="fu"><a href="https://cmu-delphi.github.io/epidatr/reference/epirange.html" class="external-link">epirange</a></span><span class="op">(</span><span class="fl">201801</span>, <span class="fl">202001</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We’re interested in the age-specific rates:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flu_data</span> <span class="op">&lt;-</span> <span class="va">flu_data_api</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">location</span>, <span class="va">epiweek</span>, <span class="va">rate_age_0</span>, <span class="va">rate_age_1</span>, <span class="va">rate_age_2</span>, <span class="va">rate_age_3</span>, <span class="va">rate_age_4</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Turn `rate_age_0`..`rate_age_4` columns into an `age_group` and `rate`</span></span>
<span>  <span class="co"># column (with 5x as many rows):</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"rate_age_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"age_group"</span>, values_to <span class="op">=</span> <span class="st">"rate"</span>,</span>
<span>    <span class="co"># When converting column names to entries in `age_group`, remove this prefix:</span></span>
<span>    names_prefix <span class="op">=</span> <span class="st">"rate_age_"</span>,</span>
<span>    <span class="co"># And add a better prefix:</span></span>
<span>    names_transform <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"age_group_"</span>, <span class="va">age_group</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Improve `age_group` labels a bit more:</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    age_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span></span>
<span>      <span class="va">age_group</span>,</span>
<span>      <span class="st">"age_group_0"</span> <span class="op">~</span> <span class="st">"0--4 yr"</span>,</span>
<span>      <span class="st">"age_group_1"</span> <span class="op">~</span> <span class="st">"5--17 yr"</span>,</span>
<span>      <span class="st">"age_group_2"</span> <span class="op">~</span> <span class="st">"18--49 yr"</span>,</span>
<span>      <span class="st">"age_group_3"</span> <span class="op">~</span> <span class="st">"50--64 yr"</span>,</span>
<span>      <span class="st">"age_group_4"</span> <span class="op">~</span> <span class="st">"&gt;= 65 yr"</span>,</span>
<span>      <span class="co"># Make this a factor with appropriate level ordering:</span></span>
<span>      .ptype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"0--4 yr"</span>, <span class="st">"5--17 yr"</span>, <span class="st">"18--49 yr"</span>,</span>
<span>        <span class="st">"50--64 yr"</span>, <span class="st">"&gt;= 65 yr"</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># The API currently outputs `epiweek` in Date format (the constituent Sunday);</span></span>
<span>  <span class="co"># rename it to remind us that it's not in YYYYww format:</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>time_value <span class="op">=</span> <span class="va">epiweek</span><span class="op">)</span></span>
<span><span class="va">flu_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 305 × 4</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">location</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">age_group</span>  <span style="font-weight: bold;">rate</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> CA       2017-12-31 0--4 yr     4.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> CA       2017-12-31 5--17 yr    1.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> CA       2017-12-31 18--49 yr   2.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> CA       2017-12-31 50--64 yr  18.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> CA       2017-12-31 &gt;= 65 yr   99.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> CA       2018-01-07 0--4 yr     4.4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 299 more rows</span></span></span></code></pre></div>
<p>We can now convert this data to an <code>epi_df</code> object and set
the <code>age_group</code> column as an additional group key:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flu_data</span> <span class="op">&lt;-</span> <span class="va">flu_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/epi_df.html">as_epi_df</a></span><span class="op">(</span>other_keys <span class="op">=</span> <span class="st">"age_group"</span><span class="op">)</span></span>
<span><span class="co">#&gt; inferring geo_value column.</span></span>
<span><span class="va">flu_data</span></span>
<span><span class="co">#&gt; An `epi_df` object, 305 x 4 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = week</span></span>
<span><span class="co">#&gt; * other_keys = age_group</span></span>
<span><span class="co">#&gt; * as_of     = 2025-04-08 20:56:19.178358</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 305 × 4</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">age_group</span> <span style="font-weight: bold;">time_value</span>  <span style="font-weight: bold;">rate</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> CA        0--4 yr   2017-12-31   4.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> CA        5--17 yr  2017-12-31   1.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> CA        18--49 yr 2017-12-31   2.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> CA        50--64 yr 2017-12-31  18.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> CA        &gt;= 65 yr  2017-12-31  99.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> CA        0--4 yr   2018-01-07   4.4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 299 more rows</span></span></span></code></pre></div>
<p>Note that the <code>epi_df</code> object now has an additional key
column <code>age_group</code>. This means that there should only be one
row for each combination of <code>geo_value</code>,
<code>age_group</code>, and <code>time_value</code> in the dataset (this
is enforced at construction time).</p>
<p>Now we can aggregate the data by <code>age_group</code>, if we want
to compute the total. For count data, this would be just a single call
to <code><a href="../reference/sum_groups_epi_df.html">sum_groups_epi_df()</a></code>. Since we are working with rates, we
need to attach some population data in order to do this aggregation.
It’s somewhat ambiguous whether FluSurv-NET reporting uses either <a href="https://www.cdc.gov/nchs/nvss/bridged_race.htm" class="external-link">NCHS</a> or <a href="https://www.census.gov/programs-surveys/popest/technical-documentation/research/evaluation-estimates/2020-evaluation-estimates/2010s-county-detail.html" class="external-link">Census</a>
populations for <code>time_value</code>s before 2020 included in reports
published in 2020 onward, but at least for this example, these two
sources agree exactly. FluSurv-NET also directly reports an overall
rate, so we can check our work.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Population estimates for FluSurv-NET-covered part of CA on 2017-07-01 and</span></span>
<span><span class="co"># 2018-07-01, extracted and aggregated from "vintage 2020" estimates (actually</span></span>
<span><span class="co"># released by Census in June 2021 and by NCHS in September 2021), which is the</span></span>
<span><span class="co"># last available reporting found with population estimates for 2017 and 2018:</span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">geo_value</span>, <span class="op">~</span><span class="va">age_group</span>,  <span class="op">~</span><span class="va">time_value</span>,           <span class="op">~</span><span class="va">pop</span>,</span>
<span>  <span class="st">"CA"</span>,       <span class="st">"0--4 yr"</span>,   <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2017-07-01"</span><span class="op">)</span>, <span class="fl">203813</span>,</span>
<span>  <span class="st">"CA"</span>,       <span class="st">"5--17 yr"</span>,  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2017-07-01"</span><span class="op">)</span>, <span class="fl">521827</span>,</span>
<span>  <span class="st">"CA"</span>,       <span class="st">"18--49 yr"</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2017-07-01"</span><span class="op">)</span>, <span class="fl">1722399</span>,</span>
<span>  <span class="st">"CA"</span>,       <span class="st">"50--64 yr"</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2017-07-01"</span><span class="op">)</span>, <span class="fl">700090</span>,</span>
<span>  <span class="st">"CA"</span>,       <span class="st">"&gt;= 65 yr"</span>,  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2017-07-01"</span><span class="op">)</span>, <span class="fl">534789</span>,</span>
<span>  <span class="st">"CA"</span>,       <span class="st">"0--4 yr"</span>,   <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2018-07-01"</span><span class="op">)</span>, <span class="fl">201265</span>,</span>
<span>  <span class="st">"CA"</span>,       <span class="st">"5--17 yr"</span>,  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2018-07-01"</span><span class="op">)</span>, <span class="fl">520077</span>,</span>
<span>  <span class="st">"CA"</span>,       <span class="st">"18--49 yr"</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2018-07-01"</span><span class="op">)</span>, <span class="fl">1725382</span>,</span>
<span>  <span class="st">"CA"</span>,       <span class="st">"50--64 yr"</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2018-07-01"</span><span class="op">)</span>, <span class="fl">699145</span>,</span>
<span>  <span class="st">"CA"</span>,       <span class="st">"&gt;= 65 yr"</span>,  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2018-07-01"</span><span class="op">)</span>, <span class="fl">551243</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co"># Calculate fraction of total population in each age group.</span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="va">pop</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>frac_pop <span class="op">=</span> <span class="va">pop</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>After joining population onto the rate data, we can calculate the
population-weighted rate for each age group, that is, the portion of
each <code>age_group</code>’s rate that it contributes to the overall
rate.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fractional_rate_by_age_group</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">flu_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">pop</span>,</span>
<span>    <span class="co"># Simple population interpolation/extrapolation scheme: last observation</span></span>
<span>    <span class="co"># carried forward. Use the estimated population on 2017-07-01 for</span></span>
<span>    <span class="co"># time_values 2017-07-01 through 2018-06-30, and the estimated population on</span></span>
<span>    <span class="co"># 2018-07-01 for all subsequent time_values:</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">age_group</span>, <span class="fu">closest</span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">time_value</span> <span class="op">&lt;=</span> <span class="va">x</span><span class="op">$</span><span class="va">time_value</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># Generate errors if the two data sets don't line up as expected:</span></span>
<span>    relationship <span class="op">=</span> <span class="st">"many-to-one"</span>, unmatched <span class="op">=</span> <span class="st">"error"</span>,</span>
<span>    <span class="co"># We'll get a second time column indicating which population estimate</span></span>
<span>    <span class="co"># was carried forward; name it time_value_for_pop:</span></span>
<span>    suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_for_pop"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rate_contrib <span class="op">=</span> <span class="va">rate</span> <span class="op">*</span> <span class="va">frac_pop</span><span class="op">)</span></span></code></pre></div>
<p>We can then use <code>sum_groups_epi_df</code> to sum
population-weighted rate across all age groups to get the overall
rate.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rate_overall_recalc_edf</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">fractional_rate_by_age_group</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/sum_groups_epi_df.html">sum_groups_epi_df</a></span><span class="op">(</span><span class="st">"rate_contrib"</span>, group_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geo_value"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>rate_overall_recalc <span class="op">=</span> <span class="va">rate_contrib</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># match rounding of original data:</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rate_overall_recalc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">rate_overall_recalc</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rate_overall_recalc_edf</span></span>
<span><span class="co">#&gt; An `epi_df` object, 61 x 3 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = week</span></span>
<span><span class="co">#&gt; * as_of     = 2025-04-08 20:56:19.178358</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 61 × 3</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">rate_overall_recalc</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> CA        2017-12-31                19.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> CA        2018-01-07                12  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> CA        2018-01-14                 9  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> CA        2018-01-21                 6.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> CA        2018-01-28                 4.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> CA        2018-02-04                 3.4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 55 more rows</span></span></span></code></pre></div>
<p>Let’s compare our calculated rate to the overall rate reported by
FluSurv-NET.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rate_overall_recalc_edf</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">rate_overall_recalc_edf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># compare to published overall rates:</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">flu_data_api</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>geo_value <span class="op">=</span> <span class="va">location</span>, time_value <span class="op">=</span> <span class="va">epiweek</span>, <span class="va">rate_overall</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geo_value"</span>, <span class="st">"time_value"</span><span class="op">)</span>,</span>
<span>    <span class="co"># validate that we have exactly the same set of geo_value x time_value combinations:</span></span>
<span>    relationship <span class="op">=</span> <span class="st">"one-to-one"</span>, unmatched <span class="op">=</span> <span class="st">"error"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># What's our maximum error vs. the official overall estimates?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">rate_overall_recalc_edf</span><span class="op">$</span><span class="va">rate_overall</span> <span class="op">-</span> <span class="va">rate_overall_recalc_edf</span><span class="op">$</span><span class="va">rate_overall_recalc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1</span></span></code></pre></div>
<p>This small amount of difference is expected, since all the
age-specific rates were rounded to the first decimal place, and
population data might have been interpolated and extrapolated a bit
differently in the official source, limiting our ability to precisely
recreate its estimates from an age group breakdown.</p>
</div>
<div class="section level2">
<h2 id="detecting-and-filling-time-gaps-with-complete-epi_df">Detecting and filling time gaps with
<code>complete.epi_df</code><a class="anchor" aria-label="anchor" href="#detecting-and-filling-time-gaps-with-complete-epi_df"></a>
</h2>
<p>Sometimes you may have missing data in your time series. This can be
due to actual missing data, or it can be due to the fact that the data
is only reported on certain days. In the latter case, it is often useful
to fill in the missing data with explicit zeros. This can be done with
the <code><a href="../reference/complete.epi_df.html">complete.epi_df()</a></code> function.</p>
<p>First, let’s create a data set with some missing data. We will reuse
the dataset <code>edf</code> from above, but modify it slightly.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edf_missing</span> <span class="op">&lt;-</span> <span class="va">edf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">geo_value</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ca"</span>, <span class="st">"tx"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edf_missing</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; An `epi_df` object, 10 x 3 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2024-03-20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 3</span></span></span>
<span><span class="co">#&gt;    <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span></span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ca        2020-03-01     6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ca        2020-03-02     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ca        2020-03-03     6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ca        2020-03-05    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ca        2020-03-06    18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> tx        2020-03-01     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> tx        2020-03-02     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> tx        2020-03-03     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> tx        2020-03-05     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> tx        2020-03-06     1</span></span></code></pre></div>
<p>Now let’s fill in the missing data with explicit zeros:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edf_missing</span> <span class="op">&lt;-</span> <span class="va">edf_missing</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span></span>
<span>    time_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">time_value</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">time_value</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cases <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edf_missing</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="co">#&gt; An `epi_df` object, 12 x 3 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2024-03-20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 3</span></span></span>
<span><span class="co">#&gt;    <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span></span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ca        2020-03-01     6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ca        2020-03-02     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ca        2020-03-03     6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ca        2020-03-04     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ca        2020-03-05    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ca        2020-03-06    18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> tx        2020-03-01     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> tx        2020-03-02     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> tx        2020-03-03     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> tx        2020-03-04     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> tx        2020-03-05     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> tx        2020-03-06     1</span></span></code></pre></div>
<p>We see that rows have been added for the missing
<code>time_value</code> 2020-03-04 for both of the states, with
<code>cases</code> set to <code>0</code>. If there were explicit
<code>NA</code>s in the <code>cases</code> column, those would have been
replaced by <code>0</code> as well.</p>
<div class="section level3">
<h3 id="detecting-and-filling-time-gaps-with-tsibble">Detecting and filling time gaps with <code>tsibble</code><a class="anchor" aria-label="anchor" href="#detecting-and-filling-time-gaps-with-tsibble"></a>
</h3>
<p>We can also use the <code>tsibble</code> package to detect and fill
time gaps. We’ll work with county-level reported COVID-19 cases in MA
and VT.</p>
<p>The data is included in the <a href="https://cmu-delphi.github.io/epidatasets/" class="external-link"><code>epidatasets</code>
package</a>, which is loaded along with <code>epiprocess</code>, and can
be accessed with:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cmu-delphi/epiprocess" class="external-link">epiprocess</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">covid_incidence_county_subset</span></span></code></pre></div>
<p>The data can also be fetched from the Delphi Epidata API with the
following query:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cmu-delphi.github.io/epidatr/" class="external-link">epidatr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-03-20"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get mapping between FIPS codes and county&amp;state names:</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://github.com/cmu-delphi/covidcast/raw/c89e4d295550ba1540d64d2cc991badf63ad04e5/Python-packages/covidcast-py/covidcast/geo_mappings/county_census.csv"</span>, <span class="co"># nolint: line_length_linter</span></span>
<span>  col_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    FIPS <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    CTYNAME <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    STNAME <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">col_character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">STNAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Massachusetts"</span>, <span class="st">"Vermont"</span><span class="op">)</span>, <span class="va">STNAME</span> <span class="op">!=</span> <span class="va">CTYNAME</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>geo_value <span class="op">=</span> <span class="va">FIPS</span>, county_name <span class="op">=</span> <span class="va">CTYNAME</span>, state_name <span class="op">=</span> <span class="va">STNAME</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fetch only counties from Massachusetts and Vermont, then append names columns as well</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cmu-delphi.github.io/epidatr/reference/pub_covidcast.html" class="external-link">pub_covidcast</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"jhu-csse"</span>,</span>
<span>  signals <span class="op">=</span> <span class="st">"confirmed_incidence_num"</span>,</span>
<span>  geo_type <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>  time_type <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>  geo_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">geo_value</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span>,</span>
<span>  time_values <span class="op">=</span> <span class="fu"><a href="https://cmu-delphi.github.io/epidatr/reference/epirange.html" class="external-link">epirange</a></span><span class="op">(</span><span class="fl">20200601</span>, <span class="fl">20211231</span><span class="op">)</span>,</span>
<span>  as_of <span class="op">=</span> <span class="va">d</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span>, cases <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">y</span>, by <span class="op">=</span> <span class="st">"geo_value"</span>, relationship <span class="op">=</span> <span class="st">"many-to-one"</span>, unmatched <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"error"</span>, <span class="st">"drop"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/epi_df.html">as_epi_df</a></span><span class="op">(</span>as_of <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p>The data contains 16,212 rows and 5 columns.</p>
</div>
</div>
<div class="section level2">
<h2 id="converting-to-tsibble-format">Converting to <code>tsibble</code> format<a class="anchor" aria-label="anchor" href="#converting-to-tsibble-format"></a>
</h2>
<p>For manipulating and wrangling time series data, the <a href="https://tsibble.tidyverts.org/index.html" class="external-link"><code>tsibble</code></a>
already provides a host of useful tools. A tsibble object (formerly, of
class <code>tbl_ts</code>) is basically a tibble (data frame) but with
two specially-marked columns: an <strong>index</strong> column
representing the time variable (defining an order from past to present),
and a <strong>key</strong> column identifying a unique observational
unit for each time point. In fact, the key can be made up of any number
of columns, not just a single one.</p>
<p>In an <code>epi_df</code> object, the index variable is
<code>time_value</code>, and the key variable is typically
<code>geo_value</code> (though this need not always be the case: for
example, if we have an age group variable as another column, then this
could serve as a second key variable). The <code>epiprocess</code>
package thus provides an implementation of <code><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble()</a></code> for
<code>epi_df</code> objects, which sets these variables according to
these defaults.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tsibble.tidyverts.org" class="external-link">tsibble</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tsibble: 6 x 5 [1D]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Key:       geo_value [1]</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span> <span style="font-weight: bold;">county_name</span>       <span style="font-weight: bold;">state_name</span>   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 25001     2020-06-01     4 Barnstable County Massachusetts</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 25001     2020-06-02     2 Barnstable County Massachusetts</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 25001     2020-06-03     6 Barnstable County Massachusetts</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 25001     2020-06-04     4 Barnstable County Massachusetts</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 25001     2020-06-05     2 Barnstable County Massachusetts</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 25001     2020-06-06     2 Barnstable County Massachusetts</span></span>
<span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/key.html" class="external-link">key</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; geo_value</span></span>
<span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/index-rd.html" class="external-link">index</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span></span>
<span><span class="co">#&gt; time_value</span></span>
<span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/regular.html" class="external-link">interval</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;interval[1]&gt;</span></span>
<span><span class="co">#&gt; [1] 1D</span></span></code></pre></div>
<p>We can also set the key variable(s) directly in a call to
<code><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble()</a></code>. Similar to SQL keys, if the key does not
uniquely identify each time point (that is, the key and index together
do not not uniquely identify each row), then <code><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble()</a></code>
throws an error:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="va">x</span>, key <span class="op">=</span> <span class="st">"county_name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `validate_tsibble()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> A valid tsibble must have distinct rows identified by key and index.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Please use `duplicates()` to check the duplicated rows.</span></span></code></pre></div>
<p>As we can see, there are duplicate county names between Massachusetts
and Vermont, which caused the error.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/duplicates.html" class="external-link">duplicates</a></span><span class="op">(</span><span class="va">x</span>, key <span class="op">=</span> <span class="st">"county_name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span> <span style="font-weight: bold;">county_name</span>     <span style="font-weight: bold;">state_name</span>   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 25009     2020-06-01    92 Essex County    Massachusetts</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 25011     2020-06-01     0 Franklin County Massachusetts</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 50009     2020-06-01     0 Essex County    Vermont      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 50011     2020-06-01     0 Franklin County Vermont      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 25009     2020-06-02    90 Essex County    Massachusetts</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 25011     2020-06-02     0 Franklin County Massachusetts</span></span></code></pre></div>
<p>Keying by both county name and state name, however, does work:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="va">x</span>, key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"county_name"</span>, <span class="st">"state_name"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tsibble: 6 x 5 [1D]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Key:       county_name, state_name [1]</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span> <span style="font-weight: bold;">county_name</span>    <span style="font-weight: bold;">state_name</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 50001     2020-06-01     0 Addison County Vermont   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 50001     2020-06-02     0 Addison County Vermont   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 50001     2020-06-03     0 Addison County Vermont   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 50001     2020-06-04     0 Addison County Vermont   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 50001     2020-06-05     0 Addison County Vermont   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 50001     2020-06-06     1 Addison County Vermont</span></span></code></pre></div>
<p>One of the major advantages of the <code>tsibble</code> package is
its ability to handle <strong>implicit gaps</strong> in time series
data. In other words, it can infer what time scale we’re interested in
(say, daily data), and detect apparent gaps (say, when values are
reported on January 1 and 3 but not January 2). We can subsequently use
functionality to make these missing entries explicit, which will
generally help avoid bugs in further downstream data processing
tasks.</p>
<p>Let’s first remove certain dates from our data set to create
gaps:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state_naming</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"https://github.com/cmu-delphi/covidcast/raw/c89e4d295550ba1540d64d2cc991badf63ad04e5/Python-packages/covidcast-py/covidcast/geo_mappings/state_census.csv"</span>, <span class="co"># nolint: line_length_linter</span></span>
<span>  col_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>NAME <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">col_character</a></span><span class="op">(</span><span class="op">)</span>, ABBR <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">col_character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>state_name <span class="op">=</span> <span class="va">NAME</span>, abbr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">ABBR</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># First make geo value more readable for tables, plots, etc.</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">state_naming</span>, by <span class="op">=</span> <span class="st">"state_name"</span>, relationship <span class="op">=</span> <span class="st">"many-to-one"</span>, unmatched <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"error"</span>, <span class="st">"drop"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>geo_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">county_name</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">county_name</span><span class="op">)</span> <span class="op">-</span> <span class="fl">7</span><span class="op">)</span>, <span class="va">state_name</span>, sep <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span>, <span class="va">cases</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cases</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>The functions <code><a href="https://tsibble.tidyverts.org/reference/has_gaps.html" class="external-link">has_gaps()</a></code>, <code><a href="https://tsibble.tidyverts.org/reference/scan_gaps.html" class="external-link">scan_gaps()</a></code>,
<code><a href="https://tsibble.tidyverts.org/reference/count_gaps.html" class="external-link">count_gaps()</a></code> in the <code>tsibble</code> package each
provide useful summaries, in slightly different formats.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/has_gaps.html" class="external-link">has_gaps</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span>                 <span style="font-weight: bold;">.gaps</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Addison, Vermont          TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Barnstable, Massachusetts TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Bennington, Vermont       TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Berkshire, Massachusetts  TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Bristol, Massachusetts    TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Caledonia, Vermont        TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/scan_gaps.html" class="external-link">scan_gaps</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tsibble: 6 x 2 [1D]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Key:       geo_value [1]</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span>        <span style="font-weight: bold;">time_value</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Addison, Vermont 2020-08-28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Addison, Vermont 2020-08-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Addison, Vermont 2020-08-30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Addison, Vermont 2020-08-31</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Addison, Vermont 2020-09-01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Addison, Vermont 2020-09-02</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/count_gaps.html" class="external-link">count_gaps</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span>        <span style="font-weight: bold;">.from</span>      <span style="font-weight: bold;">.to</span>           <span style="font-weight: bold;">.n</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Addison, Vermont 2020-08-28 2020-10-04    38</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Addison, Vermont 2020-10-06 2020-10-23    18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Addison, Vermont 2020-10-25 2020-11-04    11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Addison, Vermont 2020-11-06 2020-11-10     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Addison, Vermont 2020-11-14 2020-11-18     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Addison, Vermont 2020-11-20 2020-11-20     1</span></span></code></pre></div>
<p>We can also visualize the patterns of missingness:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://tsibble.tidyverts.org/reference/count_gaps.html" class="external-link">count_gaps</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="va">geo_value</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.from</span>, ymax <span class="op">=</span> <span class="va">.to</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.from</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.to</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"County"</span>, y <span class="op">=</span> <span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="epi_df_files/figure-html/unnamed-chunk-29-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>Using the <code><a href="https://tsibble.tidyverts.org/reference/fill_gaps.html" class="external-link">fill_gaps()</a></code> function from
<code>tsibble</code>, we can replace all gaps by an explicit value. The
default is <code>NA</code>, but in the current case, where missingness
is not at random but rather represents a small value that was censored
(only a hypothetical with COVID-19 reports, but certainly a real
phenomenon that occurs in other signals), it is better to replace it by
zero, which is what we do here. (Other approaches, such as LOCF: last
observation carried forward in time, could be accomplished by first
filling with <code>NA</code> values and then following up with a second
call to <code><a href="https://tidyr.tidyverse.org/reference/fill.html" class="external-link">tidyr::fill()</a></code>.)</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/fill_gaps.html" class="external-link">fill_gaps</a></span><span class="op">(</span><span class="va">xt</span>, cases <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tsibble: 6 x 3 [1D]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Key:       geo_value [1]</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span>        <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Addison, Vermont 2020-08-27     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Addison, Vermont 2020-08-28     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Addison, Vermont 2020-08-29     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Addison, Vermont 2020-08-30     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Addison, Vermont 2020-08-31     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Addison, Vermont 2020-09-01     0</span></span></code></pre></div>
<p>Note that the time series for Addison, VT only starts on August 27,
2020, even though the original (uncensored) data set itself was drawn
from a period that went back to June 6, 2020. By setting
<code>.full = TRUE</code>, we can at zero-fill over the entire span of
the observed (censored) data.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xt_filled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tsibble.tidyverts.org/reference/fill_gaps.html" class="external-link">fill_gaps</a></span><span class="op">(</span><span class="va">xt</span>, cases <span class="op">=</span> <span class="fl">0</span>, .full <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xt_filled</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tsibble: 6 x 3 [1D]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Key:       geo_value [1]</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span>        <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">cases</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Addison, Vermont 2020-06-01     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Addison, Vermont 2020-06-02     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Addison, Vermont 2020-06-03     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Addison, Vermont 2020-06-04     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Addison, Vermont 2020-06-05     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Addison, Vermont 2020-06-06     0</span></span></code></pre></div>
<p>Explicit imputation for missingness (zero-filling in our case) can be
important for protecting against bugs in all sorts of downstream tasks.
For example, even something as simple as a 7-day trailing average is
complicated by missingness. The function <code><a href="../reference/epi_slide.html">epi_slide()</a></code> looks
for all rows within a window of 7 days anchored on the right at the
reference time point (when <code>.window_size = 7</code>). But when some
days in a given week are missing because they were censored because they
had small case counts, taking an average of the observed case counts can
be misleading and is unintentionally biased upwards. Meanwhile, running
<code><a href="../reference/epi_slide.html">epi_slide()</a></code> on the zero-filled data brings these trailing
averages (appropriately) downwards, as we can see inspecting Plymouth,
MA around July 1, 2021.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xt</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/epi_df.html">as_epi_df</a></span><span class="op">(</span>as_of <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-03-20"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/epi_slide.html">epi_slide</a></span><span class="op">(</span>cases_7dav <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span>, .window_size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">geo_value</span> <span class="op">==</span> <span class="st">"Plymouth, MA"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">time_value</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-07-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt; An `epi_df` object, 0 x 4 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = custom</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2024-03-20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 variables: </span><span style="color: #949494; font-weight: bold;">geo_value</span><span style="color: #949494;"> &lt;chr&gt;, </span><span style="color: #949494; font-weight: bold;">time_value</span><span style="color: #949494;"> &lt;date&gt;, </span><span style="color: #949494; font-weight: bold;">cases</span><span style="color: #949494;"> &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   </span><span style="color: #949494; font-weight: bold;">cases_7dav</span><span style="color: #949494;"> &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="va">xt_filled</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/epi_df.html">as_epi_df</a></span><span class="op">(</span>as_of <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-03-20"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/epi_slide.html">epi_slide</a></span><span class="op">(</span>cases_7dav <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span>, .window_size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">geo_value</span> <span class="op">==</span> <span class="st">"Plymouth, MA"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">time_value</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-07-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt; An `epi_df` object, 0 x 4 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = custom</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2024-03-20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 variables: </span><span style="color: #949494; font-weight: bold;">geo_value</span><span style="color: #949494;"> &lt;chr&gt;, </span><span style="color: #949494; font-weight: bold;">time_value</span><span style="color: #949494;"> &lt;date&gt;, </span><span style="color: #949494; font-weight: bold;">cases</span><span style="color: #949494;"> &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   </span><span style="color: #949494; font-weight: bold;">cases_7dav</span><span style="color: #949494;"> &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="geographic-aggregation">Geographic aggregation<a class="anchor" aria-label="anchor" href="#geographic-aggregation"></a>
</h2>
<p>We do not yet provide tools for geographic aggregation in
<code>epiprocess</code>. However, we have some Python geocoding
utilities available. Reach out to us if this is functionality you would
like to see us add to <code>epiprocess</code>.</p>
</div>
<div class="section level2">
<h2 id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a>
</h2>
<p>The <code>percent_cli</code> data is a modified part of the <a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast-signals/doctor-visits.html" class="external-link">COVIDcast
Epidata API Doctor Visits data</a>. This dataset is licensed under the
terms of the <a href="https://creativecommons.org/licenses/by/4.0/" class="external-link">Creative Commons
Attribution 4.0 International license</a>. Copyright Delphi Research
Group at Carnegie Mellon University 2020.</p>
<p>This document contains a dataset that is a modified part of the <a href="https://github.com/CSSEGISandData/COVID-19" class="external-link">COVID-19 Data
Repository by the Center for Systems Science and Engineering (CSSE) at
Johns Hopkins University</a> as <a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast-signals/jhu-csse.html" class="external-link">republished
in the COVIDcast Epidata API</a>. This data set is licensed under the
terms of the <a href="https://creativecommons.org/licenses/by/4.0/" class="external-link">Creative Commons
Attribution 4.0 International license</a> by the Johns Hopkins
University on behalf of its Center for Systems Science in Engineering.
Copyright Johns Hopkins University 2020.</p>
<p><a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast-signals/jhu-csse.html" class="external-link">From
the COVIDcast Epidata API</a>: These signals are taken directly from the
JHU CSSE <a href="https://github.com/CSSEGISandData/COVID-19" class="external-link">COVID-19
GitHub repository</a> without changes.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p><a href="https://delphi.cmu.edu/about/" class="external-link">About Delphi</a> • <a href="https://delphi.cmu.edu/epidemic-signals/terms-of-use/" class="external-link">Terms of Use</a> • <a href="https://docs.google.com/forms/u/1/d/e/1FAIpQLScqgT1fKZr5VWBfsaSp-DNaN03aV6EoZU4YljIzHJ1Wl_zmtg/viewform" class="external-link">Contact Us</a> • <a href="https://github.com/cmu-delphi/" class="external-link">Delphi GitHub</a> • <a href="https://cmu-delphi.github.io/delphi-epidata/" class="external-link">Epidata API</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>epiprocess</p>
</div>

    </footer>
</div>





  </body>
</html>
