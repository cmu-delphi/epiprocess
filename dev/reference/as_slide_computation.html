<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate a epi[x]_slide computation function from a function, formula, or quosure — as_slide_computation • epiprocess</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Serif_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate a epi[x]_slide computation function from a function, formula, or quosure — as_slide_computation"><meta name="description" content="as_slide_computation() transforms a one-sided formula or a
quosure into a function; functions are returned as-is or with light
modifications to calculate ref_time_value.
This code extends rlang::as_function to create functions that take three
arguments. The arguments can be accessed via the idiomatic ., .x, and
.y, extended to include .z; positional references ..1 and ..2,
extended to include ..3; and also by epi[x]_slide-specific names
.group_key and .ref_time_value."><meta property="og:description" content="as_slide_computation() transforms a one-sided formula or a
quosure into a function; functions are returned as-is or with light
modifications to calculate ref_time_value.
This code extends rlang::as_function to create functions that take three
arguments. The arguments can be accessed via the idiomatic ., .x, and
.y, extended to include .z; positional references ..1 and ..2,
extended to include ..3; and also by epi[x]_slide-specific names
.group_key and .ref_time_value."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epiprocess</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.12.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/epiprocess.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/epi_df.html">Working with epi_df objects and time series data</a></li>
    <li><a class="dropdown-item" href="../articles/epi_archive.html">Working with epi_archive objects and data revisions</a></li>
    <li><a class="dropdown-item" href="../articles/outliers.html">Detect and correct outliers in signals</a></li>
    <li><a class="dropdown-item" href="../articles/growth_rate.html">Estimate growth rates in signals</a></li>
    <li><a class="dropdown-item" href="../articles/correlation.html">Correlate signals across locations and time</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cmu-delphi/epiprocess/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate a <code>epi[x]_slide</code> computation function from a function, formula, or quosure</h1>
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epiprocess/blob/dev/R/utils.R" class="external-link"><code>R/utils.R</code></a></small>
      <div class="d-none name"><code>as_slide_computation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>as_slide_computation()</code> transforms a one-sided formula or a
quosure into a function; functions are returned as-is or with light
modifications to calculate <code>ref_time_value</code>.</p>
<p>This code extends <code><a href="https://rlang.r-lib.org/reference/as_function.html" class="external-link">rlang::as_function</a></code> to create functions that take three
arguments. The arguments can be accessed via the idiomatic <code>.</code>, <code>.x</code>, and
<code>.y</code>, extended to include <code>.z</code>; positional references <code>..1</code> and <code>..2</code>,
extended to include <code>..3</code>; and also by <code>epi[x]_slide</code>-specific names
<code>.group_key</code> and <code>.ref_time_value</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">as_slide_computation</span><span class="op">(</span></span>
<span>  <span class="va">.f</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .f_arg <span class="op">=</span> <span class="fu">caller_arg</span><span class="op">(</span><span class="va">.f</span><span class="op">)</span>,</span>
<span>  .call <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">.ref_time_value_long_varnames</span>,</span>
<span>  <span class="va">.ref_time_value_label</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">as_time_slide_computation</span><span class="op">(</span></span>
<span>  <span class="va">.f</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .f_arg <span class="op">=</span> <span class="fu">caller_arg</span><span class="op">(</span><span class="va">.f</span><span class="op">)</span>,</span>
<span>  .call <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">as_diagonal_slide_computation</span><span class="op">(</span></span>
<span>  <span class="va">.f</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .f_arg <span class="op">=</span> <span class="fu">caller_arg</span><span class="op">(</span><span class="va">.f</span><span class="op">)</span>,</span>
<span>  .call <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="source">Source<a class="anchor" aria-label="anchor" href="#source"></a></h2>
    <p>This code and documentation are based on
<a href="https://github.com/r-lib/rlang/blob/c55f6027928d3104ed449e591e8a225fcaf55e13/R/fn.R#L343-L427" class="external-link"><code>as_function</code></a>
from Hadley Wickham's <code>rlang</code> package.</p>
<p>Below is the original license for the <code>rlang</code> package.</p>
<p>MIT License</p>
<p>Copyright (c) 2020 rlang authors</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p>
<p>Portions of the original code used in this adaptation:</p><ol><li><p>Much of the documentation and examples</p></li>
<li><p>The general flow of the function, including branching conditions</p></li>
<li><p>Error conditions and wording</p></li>
<li><p>The chunk converting a formula into a function, see
https://github.com/r-lib/rlang/blob/c55f6027928d3104ed449e591e8a225fcaf55e13/R/fn.R#L411-L418</p></li>
</ol><p>Changes made include:</p><ol><li><p>Updates to documentation due to new functionality</p></li>
<li><p>The removal of function-as-string processing logic and helper arg
<code>env</code></p></li>
<li><p>The addition of an output function wrapper that defines a data mask
for evaluating quosures</p></li>
<li><p>Calling an argument-checking function</p></li>
<li><p>Replacing rlang error functions with internal error functions</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to pass to the function or formula
specified via <code>x</code>. If <code>x</code> is a quosure, any arguments passed via <code>...</code>
will be ignored.</p></dd>


<dt id="arg--ref-time-value-long-varnames">.ref_time_value_long_varnames<a class="anchor" aria-label="anchor" href="#arg--ref-time-value-long-varnames"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a>
Character vector. What variable names should we allow formulas and
data-masking tidy evaluation to use to refer to <code>ref_time_value</code> for the
computation (in addition to <code>.z</code> in formulas)? E.g., <code>".ref_time_value"</code> or
<code>c(".ref_time_value", ".version")</code>.</p></dd>


<dt id="arg--ref-time-value-label">.ref_time_value_label<a class="anchor" aria-label="anchor" href="#arg--ref-time-value-label"></a></dt>
<dd><p>String; how to describe/label the <code>ref_time_value</code> in
error messages; e.g., "reference time value" or "version".</p></dd>


<dt id="arg-f">f<a class="anchor" aria-label="anchor" href="#arg-f"></a></dt>
<dd><p>A function, one-sided formula, or quosure.</p>
<p>If a <strong>function</strong>, the function is returned as-is, with no
modifications.</p>
<p>If a <strong>formula</strong>, e.g. <code>~ mean(.x$cases)</code>, it is converted to a function
with up to three arguments: <code>.x</code> (single argument), or <code>.x</code> and <code>.y</code>
(two arguments), or <code>.x</code>, <code>.y</code>, and <code>.z</code> (three arguments). The <code>.</code>
placeholder can be used instead of <code>.x</code>, <code>.group_key</code> can be used in
place of <code>.y</code>, and <code>.ref_time_value</code> can be used in place of <code>.z</code>. This
allows you to create very compact anonymous functions (lambdas) with up
to three inputs. Functions created from formulas have a special class.
Use <code>inherits(fn, "epiprocess_slide_computation")</code> to test for it.</p>
<p>If a <strong>quosure</strong>, in the case that <code>f</code> was not provided to the parent
<code>epi[x]_slide</code> call and the <code>...</code> is interpreted as an expression for
tidy evaluation, it is evaluated within a wrapper function. The wrapper
sets up object access via a data mask.</p></dd>

</dl></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p><a href="https://delphi.cmu.edu/about/" class="external-link">About Delphi</a> • <a href="https://delphi.cmu.edu/epidemic-signals/terms-of-use/" class="external-link">Terms of Use</a> • <a href="https://docs.google.com/forms/u/1/d/e/1FAIpQLScqgT1fKZr5VWBfsaSp-DNaN03aV6EoZU4YljIzHJ1Wl_zmtg/viewform" class="external-link">Contact Us</a> • <a href="https://github.com/cmu-delphi/" class="external-link">Delphi GitHub</a> • <a href="https://cmu-delphi.github.io/delphi-epidata/" class="external-link">Epidata API</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>epiprocess</p>
</div>

    </footer></div>





  </body></html>

