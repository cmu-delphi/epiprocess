<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>A function to describe revision behavior for an archive. — revision_summary • epiprocess</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Serif_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A function to describe revision behavior for an archive. — revision_summary"><meta name="description" content="revision_summary removes all missing values (if requested), and then
computes some basic statistics about the revision behavior of an archive,
returning a tibble summarizing the revisions per time_value+epi_key
features. If print_inform is true, it prints a concise summary. The
columns returned are:
n_revisions: the total number of revisions for that entry
min_lag: the minimum time to any value (if drop_nas=FALSE, this
includes NA's)
max_lag: the amount of time until the final (new) version (same caveat
for drop_nas=FALSE, though it is far less likely to matter)
min_value: the minimum value across revisions
max_value: the maximum value across revisions
median_value: the median value across revisions
spread: the difference between the smallest and largest values (this
always excludes NA values)
rel_spread: spread divided by the largest value (so it will
always be less than 1). Note that this need not be the final value. It will
be NA whenever spread is 0.
time_near_latest: the time taken for the revisions to settle to within
within_latest (default 20%) of the final value and stay there. For
example, consider the series (0, 20, 99, 150, 102, 100); then
time_near_latest is 5, since even though 99 is within 20%, it is outside
the window afterwards at 150.

"><meta property="og:description" content="revision_summary removes all missing values (if requested), and then
computes some basic statistics about the revision behavior of an archive,
returning a tibble summarizing the revisions per time_value+epi_key
features. If print_inform is true, it prints a concise summary. The
columns returned are:
n_revisions: the total number of revisions for that entry
min_lag: the minimum time to any value (if drop_nas=FALSE, this
includes NA's)
max_lag: the amount of time until the final (new) version (same caveat
for drop_nas=FALSE, though it is far less likely to matter)
min_value: the minimum value across revisions
max_value: the maximum value across revisions
median_value: the median value across revisions
spread: the difference between the smallest and largest values (this
always excludes NA values)
rel_spread: spread divided by the largest value (so it will
always be less than 1). Note that this need not be the final value. It will
be NA whenever spread is 0.
time_near_latest: the time taken for the revisions to settle to within
within_latest (default 20%) of the final value and stay there. For
example, consider the series (0, 20, 99, 150, 102, 100); then
time_near_latest is 5, since even though 99 is within 20%, it is outside
the window afterwards at 150.

"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epiprocess</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.9.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/epiprocess.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/epi_df.html">Working with epi_df objects and time series data</a></li>
    <li><a class="dropdown-item" href="../articles/epi_archive.html">Working with epi_archive objects and data revisions</a></li>
    <li><a class="dropdown-item" href="../articles/outliers.html">Detect and correct outliers in signals</a></li>
    <li><a class="dropdown-item" href="../articles/growth_rate.html">Estimate growth rates in signals</a></li>
    <li><a class="dropdown-item" href="../articles/correlation.html">Correlate signals across locations and time</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cmu-delphi/epiprocess/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>A function to describe revision behavior for an archive.</h1>
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epiprocess/R/revision_analysis.R" class="external-link"><code>R/revision_analysis.R</code></a></small>
      <div class="d-none name"><code>revision_summary.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>revision_summary</code> removes all missing values (if requested), and then
computes some basic statistics about the revision behavior of an archive,
returning a tibble summarizing the revisions per time_value+epi_key
features. If <code>print_inform</code> is true, it prints a concise summary. The
columns returned are:</p><ol><li><p><code>n_revisions</code>: the total number of revisions for that entry</p></li>
<li><p><code>min_lag</code>: the minimum time to any value (if <code>drop_nas=FALSE</code>, this
includes <code>NA</code>'s)</p></li>
<li><p><code>max_lag</code>: the amount of time until the final (new) version (same caveat
for <code>drop_nas=FALSE</code>, though it is far less likely to matter)</p></li>
<li><p><code>min_value</code>: the minimum value across revisions</p></li>
<li><p><code>max_value</code>: the maximum value across revisions</p></li>
<li><p><code>median_value</code>: the median value across revisions</p></li>
<li><p><code>spread</code>: the difference between the smallest and largest values (this
always excludes <code>NA</code> values)</p></li>
<li><p><code>rel_spread</code>: <code>spread</code> divided by the largest value (so it will
always be less than 1). Note that this need not be the final value. It will
be <code>NA</code> whenever <code>spread</code> is 0.</p></li>
<li><p><code>time_near_latest</code>: the time taken for the revisions to settle to within
<code>within_latest</code> (default 20%) of the final value and stay there. For
example, consider the series (0, 20, 99, 150, 102, 100); then
<code>time_near_latest</code> is 5, since even though 99 is within 20%, it is outside
the window afterwards at 150.</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">revision_summary</span><span class="op">(</span></span>
<span>  <span class="va">epi_arch</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  drop_nas <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  print_inform <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  min_waiting_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">as.difftime</a></span><span class="op">(</span><span class="fl">60</span>, units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span>,</span>
<span>  within_latest <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  quick_revision <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">as.difftime</a></span><span class="op">(</span><span class="fl">3</span>, units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span>,</span>
<span>  few_revisions <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  abs_spread_threshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rel_spread_threshold <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  compactify_tol <span class="op">=</span> <span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">^</span><span class="fl">0.5</span>,</span>
<span>  should_compactify <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-epi-arch">epi_arch<a class="anchor" aria-label="anchor" href="#arg-epi-arch"></a></dt>
<dd><p>an epi_archive to be analyzed</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>&lt;<code><a href="https://dplyr.tidyverse.org/reference/dplyr_tidy_select.html" class="external-link">tidyselect</a></code>&gt;, used to choose the column to
summarize. If empty, it chooses the first. Currently only implemented for
one column at a time.</p></dd>


<dt id="arg-drop-nas">drop_nas<a class="anchor" aria-label="anchor" href="#arg-drop-nas"></a></dt>
<dd><p>bool, drop any <code>NA</code> values from the archive? After dropping
<code>NA</code>'s compactify is run again to make sure there are no duplicate values
from occasions when the signal is revised to <code>NA</code>, and then back to its
immediately-preceding value.</p></dd>


<dt id="arg-print-inform">print_inform<a class="anchor" aria-label="anchor" href="#arg-print-inform"></a></dt>
<dd><p>bool, determines whether to print summary information, or
only return the full summary tibble</p></dd>


<dt id="arg-min-waiting-period">min_waiting_period<a class="anchor" aria-label="anchor" href="#arg-min-waiting-period"></a></dt>
<dd><p><code>difftime</code>, integer or <code>NULL</code>. Sets a cutoff: any
time_values not earlier than <code>min_waiting_period</code> before <code>versions_end</code> are
removed. <code>min_waiting_period</code> should characterize the typical time during
which revisions occur.  The default of 60 days corresponds to a typical
final value for case counts as reported in the context of insurance. To
avoid this filtering, either set to <code>NULL</code> or 0.</p></dd>


<dt id="arg-within-latest">within_latest<a class="anchor" aria-label="anchor" href="#arg-within-latest"></a></dt>
<dd><p>double between 0 and 1. Determines the threshold
used for the <code>time_to</code></p></dd>


<dt id="arg-quick-revision">quick_revision<a class="anchor" aria-label="anchor" href="#arg-quick-revision"></a></dt>
<dd><p>difftime or integer (integer is treated as days), for
the printed summary, the amount of time between the final revision and the
actual time_value to consider the revision quickly resolved. Default of 3
days</p></dd>


<dt id="arg-few-revisions">few_revisions<a class="anchor" aria-label="anchor" href="#arg-few-revisions"></a></dt>
<dd><p>integer, for the printed summary, the upper bound on the
number of revisions to consider "few". Default is 3.</p></dd>


<dt id="arg-abs-spread-threshold">abs_spread_threshold<a class="anchor" aria-label="anchor" href="#arg-abs-spread-threshold"></a></dt>
<dd><p>numeric, for the printed summary, the maximum
spread used to characterize revisions which don't actually change very
much. Default is 5% of the maximum value in the dataset, but this is the
most unit dependent of values, and likely needs to be chosen appropriate
for the scale of the dataset.</p></dd>


<dt id="arg-rel-spread-threshold">rel_spread_threshold<a class="anchor" aria-label="anchor" href="#arg-rel-spread-threshold"></a></dt>
<dd><p>float between 0 and 1, for the printed summary,
the relative spread fraction used to characterize revisions which don't
actually change very much. Default is .1, or 10% of the final value</p></dd>


<dt id="arg-compactify-tol">compactify_tol<a class="anchor" aria-label="anchor" href="#arg-compactify-tol"></a></dt>
<dd><p>float, used if <code>drop_nas=TRUE</code>, it determines the
threshold for when two floats are considered identical.</p></dd>


<dt id="arg-should-compactify">should_compactify<a class="anchor" aria-label="anchor" href="#arg-should-compactify"></a></dt>
<dd><p>bool. Compactify if <code>TRUE</code>.</p></dd>

</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">revision_example</span> <span class="op">&lt;-</span> <span class="fu">revision_summary</span><span class="op">(</span><span class="va">archive_cases_dv_subset</span>, <span class="va">percent_cli</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Min lag (time to first version):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      min median     mean     max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3 days 3 days 3.5 days 12 days</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Fraction of epi_key+time_values with</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No revisions:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • 0 out of 1,956 (0%)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Quick revisions (last revision within 3 days of the `time_value`):</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • 0 out of 1,956 (0%)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Few revisions (At most 3 revisions for that `time_value`):</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • 0 out of 1,956 (0%)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Fraction of revised epi_key+time_values which have:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Less than 0.1 spread in relative value:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • 91 out of 1,956 (4.65%)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Spread of more than 2.22056495 in actual value (when revised):</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • 671 out of 1,956 (34.3%)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> days until within 20% of the latest value:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      min median     mean     max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3 days 5 days 9.1 days 67 days</span>
<span class="r-in"><span><span class="va">revision_example</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">spread</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1,956 × 11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    time_value geo_value n_revisions min_lag max_lag time_near_latest spread</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;drtn&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;drtn&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;drtn&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 2020-12-26 ca                 62 3 days  73 days  6 days           14.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 2020-12-25 ca                 62 3 days  73 days  7 days           13.2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 2020-11-27 fl                 66 3 days  73 days  4 days           12.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 2021-09-27 fl                 43 3 days  63 days 59 days            9.79</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 2020-12-25 fl                 62 3 days  73 days  4 days            9.75</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 2021-09-26 fl                 43 4 days  64 days 60 days            9.48</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 2021-09-27 ca                 43 3 days  63 days  8 days            9.31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 2021-09-25 fl                 43 5 days  65 days 61 days            8.83</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 2020-11-05 ny                 66 3 days  73 days 11 days            8.64</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 2020-11-27 tx                 66 3 days  73 days 10 days            8.56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 1,946 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 4 more variables: rel_spread &lt;dbl&gt;, min_value &lt;dbl&gt;, max_value &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   median_value &lt;dbl&gt;</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p><a href="https://delphi.cmu.edu/about/" class="external-link">About Delphi</a> • <a href="https://delphi.cmu.edu/epidemic-signals/terms-of-use/" class="external-link">Terms of Use</a> • <a href="https://docs.google.com/forms/u/1/d/e/1FAIpQLScqgT1fKZr5VWBfsaSp-DNaN03aV6EoZU4YljIzHJ1Wl_zmtg/viewform" class="external-link">Contact Us</a> • <a href="https://github.com/cmu-delphi/" class="external-link">Delphi GitHub</a> • <a href="https://cmu-delphi.github.io/delphi-epidata/" class="external-link">Epidata API</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>epiprocess</p>
</div>

    </footer></div>





  </body></html>

