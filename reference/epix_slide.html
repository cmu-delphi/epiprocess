<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Take each requested (group and) version in an archive, run a computation (e.g., forecast) — epix_slide • epiprocess</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Serif_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Take each requested (group and) version in an archive, run a computation (e.g., forecast) — epix_slide"><meta name="description" content='... and collect the results. This is useful for more accurately simulating
how a forecaster, nowcaster, or other algorithm would have behaved in real
time, factoring in reporting latency and data revisions; see
vignette("backtesting", package="epipredict") for a walkthrough.'><meta property="og:description" content='... and collect the results. This is useful for more accurately simulating
how a forecaster, nowcaster, or other algorithm would have behaved in real
time, factoring in reporting latency and data revisions; see
vignette("backtesting", package="epipredict") for a walkthrough.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epiprocess</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.12.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/epiprocess.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/epi_df.html">Working with epi_df objects and time series data</a></li>
    <li><a class="dropdown-item" href="../articles/epi_archive.html">Working with epi_archive objects and data revisions</a></li>
    <li><a class="dropdown-item" href="../articles/outliers.html">Detect and correct outliers in signals</a></li>
    <li><a class="dropdown-item" href="../articles/growth_rate.html">Estimate growth rates in signals</a></li>
    <li><a class="dropdown-item" href="../articles/correlation.html">Correlate signals across locations and time</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cmu-delphi/epiprocess/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Take each requested (group and) version in an archive, run a computation (e.g., forecast)</h1>
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epiprocess/blob/main/R/methods-epi_archive.R" class="external-link"><code>R/methods-epi_archive.R</code></a></small>
      <div class="d-none name"><code>epix_slide.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>... and collect the results. This is useful for more accurately simulating
how a forecaster, nowcaster, or other algorithm would have behaved in real
time, factoring in reporting latency and data revisions; see
<a href="https://cmu-delphi.github.io/epipredict/articles/backtesting.html" class="external-link"><code>vignette("backtesting", package="epipredict")</code></a> for a walkthrough.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">epix_slide</span><span class="op">(</span></span>
<span>  <span class="va">.x</span>,</span>
<span>  <span class="va">.f</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .before <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  .versions <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .new_col_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .all_versions <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--x">.x<a class="anchor" aria-label="anchor" href="#arg--x"></a></dt>
<dd><p>An <code><a href="epi_archive.html">epi_archive</a></code> or <code><a href="group_by.epi_archive.html">grouped_epi_archive</a></code> object. If ungrouped,
all data in <code>x</code> will be treated as part of a single data group.</p></dd>


<dt id="arg--f">.f<a class="anchor" aria-label="anchor" href="#arg--f"></a></dt>
<dd><p>Function, formula, or missing; together with <code>...</code> specifies the
computation. The computation will be run on each requested group-version
combination, with a time window filter applied if <code>.before</code> is supplied.</p>
<p>If <code>.f</code> is a function must have the form <code>function(x, g, v)</code> or
<code>function(x, g, v, &lt;additional configuration args&gt;)</code>, where</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="sc">-</span> <span class="st">`</span><span class="at">x</span><span class="st">`</span> is an <span class="st">`</span><span class="at">epi_df</span><span class="st">`</span> with the same column names as the archive<span class="st">'s `DT`,</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="st">  minus the `version` column. (Or, if `.all_versions = TRUE`, an</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="st">  `epi_archive` with the requested partial version history.)</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="st">- `g` is a one-row tibble containing the values of the grouping variables</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="st">  for the associated group.</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="st">- `v` (length-1) is the associated `version` (one of the requested</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="st">  `.versions`)</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="st">- `&lt;additional configuration args&gt;` are optional; you can add such</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="st">  arguments to your function and set them by passing them through the</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="st">  `...` argument to `epix_slide()`.</span></span></code></pre><p></p></div>
<p>If a formula, <code>.f</code> can operate directly on columns accessed via <code>.x$var</code> or
<code>.$var</code>, as in <code>~ mean (.x$var)</code> to compute a mean of a column <code>var</code> for
each group-<code>ref_time_value</code> combination. The group key can be accessed via
<code>.y</code> or <code>.group_key</code>, and the reference time value can be accessed via
<code>.z</code>, <code>.version</code>, or <code>.ref_time_value</code>. If <code>.f</code> is missing, then <code>...</code> will
specify the computation.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to pass to the function or formula specified
via <code>f</code>. Alternatively, if <code>.f</code> is missing, then the <code>...</code> is interpreted
as a <a href="https://rlang.r-lib.org/reference/args_data_masking.html" class="external-link">"data-masking"</a> expression or expressions
for tidy evaluation; in addition to referring columns directly by name, the
expressions have access to <code>.data</code> and <code>.env</code> pronouns as in <code>dplyr</code> verbs,
and can also refer to <code>.x</code> (not the same as the input epi_archive),
<code>.group_key</code> and <code>.version</code>/<code>.ref_time_value</code>. See details for more.</p></dd>


<dt id="arg--before">.before<a class="anchor" aria-label="anchor" href="#arg--before"></a></dt>
<dd><p>Optional; applies a <code>time_value</code> filter before running each
computation. The default is not to apply a <code>time_value</code> filter. If
provided, it should be a single integer or difftime that is compatible with
the time_type of the time_value column. If an integer, then the minimum
possible <code>time_value</code> included will be that many time steps (according to
the <code>time_type</code>) before each requested <code>.version</code>. This window endpoint is
inclusive. For example, if <code>.before = 14</code>, the <code>time_type</code> in the archive
is "day", and the requested <code>.version</code> is January 15, then the smallest
possible <code>time_value</code> possible in the snapshot will be January 1. Note that
this does not mean that there will be 14 or 15 distinct <code>time_value</code>s
actually appearing in the data; for most reporting streams, reporting as of
January 15 won't include <code>time_value</code>s all the way through January 14, due
to reporting latency. Unlike <code><a href="epi_slide.html">epi_slide()</a></code>, <code>epix_slide()</code> won't fill in
any missing <code>time_values</code> in this window.</p></dd>


<dt id="arg--versions">.versions<a class="anchor" aria-label="anchor" href="#arg--versions"></a></dt>
<dd><p>Requested versions on which to run the computation. Each
requested <code>.version</code> also serves as the anchor point from which
the <code>time_value</code> window specified by <code>.before</code> is drawn. If <code>.versions</code> is
missing, it will be set to a regularly-spaced sequence of values set to
cover the range of <code>version</code>s in the <code>DT</code> plus the <code>versions_end</code>; the
spacing of values will be guessed (using the GCD of the skips between
values).</p></dd>


<dt id="arg--new-col-name">.new_col_name<a class="anchor" aria-label="anchor" href="#arg--new-col-name"></a></dt>
<dd><p>Either <code>NULL</code> or a string indicating the name of the new
column that will contain the derived values. The default, <code>NULL</code>, will use
the name "slide_value" unless your slide computations output data frames,
in which case they will be unpacked into the constituent columns and the
data frame's column names will be used instead. If the resulting column
name(s) overlap with the column names used for labeling the computations,
which are <code>group_vars(x)</code> and <code>"version"</code>, then the values for these
columns must be identical to the labels we assign.</p></dd>


<dt id="arg--all-versions">.all_versions<a class="anchor" aria-label="anchor" href="#arg--all-versions"></a></dt>
<dd><p>(Not the same as <code>.all_rows</code> parameter of <code>epi_slide</code>.)
If <code>.all_versions = TRUE</code>, then the slide computation will be passed the
version history (all versions <code>&lt;= .version</code> where <code>.version</code> is one of the
requested <code>.version</code>s), in <code>epi_archive</code> format. Otherwise, the slide
computation will be passed only the most recent <code>version</code> for every unique
<code>time_value</code>, in <code>epi_df</code> format. Default is <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A tibble whose columns are: the grouping variables (if any),
<code>time_value</code>, containing the reference time values for the slide
computation, and a column named according to the <code>.new_col_name</code> argument,
containing the slide values. It will be grouped by the grouping variables.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This is similar to looping over versions and calling <code><a href="epix_as_of.html">epix_as_of</a></code>, but has
some conveniences such as working naturally with <code><a href="group_by.epi_archive.html">grouped_epi_archive</a></code>s,
optional time windowing, and syntactic sugar to make things shorter to write.</p>
<p>A few key distinctions between the current function and <code><a href="epi_slide.html">epi_slide()</a></code>:</p><ol><li><p>In <code>.f</code> functions for <code>epix_slide</code>, one should not assume that the input
data to contain any rows with <code>time_value</code> matching the computation's
<code>.version</code>, due to reporting latency; for typical epidemiological
surveillance data, observations pertaining to a particular time period
(<code>time_value</code>) are first reported <code>as_of</code> some instant after that time
period has ended. No time window completion is performed as in
<code><a href="epi_slide.html">epi_slide()</a></code>.</p></li>
<li><p>The input class and columns are similar but different: <code>epix_slide</code>
(with the default <code>.all_versions=FALSE</code>) keeps all columns and the
<code>epi_df</code>-ness of the first argument to each computation; <code>epi_slide</code> only
provides the grouping variables in the second input, and will convert the
first input into a regular tibble if the grouping variables include the
essential <code>geo_value</code> column. (With <code>.all_versions=TRUE</code>, <code>epix_slide</code>
will provide an <code>epi_archive</code> rather than an <code>epi-df</code> to each
computation.)</p></li>
<li><p>The output class and columns are similar but different: <code>epix_slide()</code>
returns a tibble containing only the grouping variables, <code>time_value</code>, and
the new column(s) from the slide computations, whereas <code><a href="epi_slide.html">epi_slide()</a></code>
returns an <code>epi_df</code> with all original variables plus the new columns from
the slide computations. (Both will mirror the grouping or ungroupedness of
their input, with one exception: <code>epi_archive</code>s can have trivial
(zero-variable) groupings, but these will be dropped in <code>epix_slide</code>
results as they are not supported by tibbles.)</p></li>
<li><p>There are no size stability checks or element/row recycling to maintain
size stability in <code>epix_slide</code>, unlike in <code>epi_slide</code>. (<code>epix_slide</code> is
roughly analogous to <code><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">dplyr::group_modify</a></code>, while <code>epi_slide</code> is roughly
analogous to <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate</a></code>.)</p></li>
<li><p><code>.all_rows</code> is not supported in <code>epix_slide</code>; since the slide
computations are allowed more flexibility in their outputs than in
<code>epi_slide</code>, we can't guess a good representation for missing computations
for excluded group-<code>.ref_time_value</code> pairs.</p></li>
<li><p>The <code>.versions</code> default for <code>epix_slide</code> is based on making an
evenly-spaced sequence out of the <code>version</code>s in the <code>DT</code> plus the
<code>versions_end</code>, rather than all unique <code>time_value</code>s.</p></li>
<li><p><code>epix_slide()</code> computations can refer to the current element of
<code>.versions</code> as either <code>.version</code> or <code>.ref_time_value</code>, while <code><a href="epi_slide.html">epi_slide()</a></code>
computations refer to the current element of <code>.ref_time_values</code> with
<code>.ref_time_value</code>.</p></li>
</ol><p>Apart from the above distinctions, the interfaces between <code>epix_slide()</code> and
<code><a href="epi_slide.html">epi_slide()</a></code> are the same.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Request only a small set of versions, for example's sake:</span></span></span>
<span class="r-in"><span><span class="va">requested_versions</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-09-02"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-09-15"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"1 day"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Investigate reporting lag of `percent_cli` signal (though normally we'd</span></span></span>
<span class="r-in"><span><span class="co"># probably work off of the dedicated `revision_summary()` function instead):</span></span></span>
<span class="r-in"><span><span class="va">archive_cases_dv_subset</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">epix_slide</span><span class="op">(</span></span></span>
<span class="r-in"><span>    geowide_percent_cli_max_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">time_value</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">percent_cli</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    geowide_percent_cli_rpt_lag <span class="op">=</span> <span class="va">.version</span> <span class="op">-</span> <span class="va">geowide_percent_cli_max_time</span>,</span></span>
<span class="r-in"><span>    .versions <span class="op">=</span> <span class="va">requested_versions</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 14 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    version    geowide_percent_cli_max_time geowide_percent_cli_rpt_lag</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;drtn&gt;</span>                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 2020-09-02 2020-08-30                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 2020-09-03 2020-08-31                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 2020-09-04 2020-09-01                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 2020-09-05 2020-09-02                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 2020-09-06 2020-09-03                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 2020-09-07 2020-09-04                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 2020-09-08 2020-09-05                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 2020-09-09 2020-09-06                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 2020-09-10 2020-09-07                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 2020-09-11 2020-09-08                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span> 2020-09-12 2020-09-09                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span> 2020-09-13 2020-09-10                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">13</span> 2020-09-14 2020-09-11                   3 days                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">14</span> 2020-09-15 2020-09-12                   3 days                     </span>
<span class="r-in"><span><span class="va">archive_cases_dv_subset</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">epix_slide</span><span class="op">(</span></span></span>
<span class="r-in"><span>    percent_cli_max_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">time_value</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">percent_cli</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    percent_cli_rpt_lag <span class="op">=</span> <span class="va">.version</span> <span class="op">-</span> <span class="va">percent_cli_max_time</span>,</span></span>
<span class="r-in"><span>    .versions <span class="op">=</span> <span class="va">requested_versions</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 56 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># Groups:   geo_value [4]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    geo_value version    percent_cli_max_time percent_cli_rpt_lag</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;drtn&gt;</span>             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> ca        2020-09-02 2020-08-30           3 days             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> fl        2020-09-02 2020-08-30           3 days             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> ny        2020-09-02 2020-08-30           3 days             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> tx        2020-09-02 2020-08-30           3 days             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> ca        2020-09-03 2020-08-31           3 days             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> fl        2020-09-03 2020-08-31           3 days             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> ny        2020-09-03 2020-08-31           3 days             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> tx        2020-09-03 2020-08-31           3 days             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> ca        2020-09-04 2020-09-01           3 days             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> fl        2020-09-04 2020-09-01           3 days             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 46 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Backtest a forecaster "pseudoprospectively" (i.e., faithfully with respect</span></span></span>
<span class="r-in"><span><span class="co"># to the data version history):</span></span></span>
<span class="r-in"><span><span class="va">case_death_rate_archive</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">epix_slide</span><span class="op">(</span></span></span>
<span class="r-in"><span>    .versions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2021-10-01"</span>, <span class="st">"2021-10-08"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">g</span>, <span class="va">v</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu">epipredict</span><span class="fu">::</span><span class="fu"><a href="https://cmu-delphi.github.io/epipredict/reference/arx_forecaster.html" class="external-link">arx_forecaster</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="va">x</span>,</span></span>
<span class="r-in"><span>        outcome <span class="op">=</span> <span class="st">"death_rate"</span>,</span></span>
<span class="r-in"><span>        predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"death_rate_7d_av"</span>, <span class="st">"case_rate_7d_av"</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">)</span><span class="op">$</span><span class="va">predictions</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Registered S3 method overwritten by 'epipredict':</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   method            from   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   print.step_naomit recipes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 112 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    version    geo_value  .pred .pred_distn forecast_date target_date</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;qtls(7)&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 2021-10-01 ak        1.95        [1.95] 2021-09-30    2021-10-07 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 2021-10-01 al        1.36        [1.36] 2021-09-30    2021-10-07 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 2021-10-01 ar        0.572      [0.572] 2021-09-30    2021-10-07 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 2021-10-01 as        0.012<span style="text-decoration: underline;">8</span>    [0.0128] 2021-09-30    2021-10-07 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 2021-10-01 az        0.537      [0.537] 2021-09-30    2021-10-07 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 2021-10-01 ca        0.260       [0.26] 2021-09-30    2021-10-07 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 2021-10-01 co        0.308      [0.308] 2021-09-30    2021-10-07 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 2021-10-01 ct        0.406      [0.406] 2021-09-30    2021-10-07 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 2021-10-01 dc        0.147      [0.147] 2021-09-30    2021-10-07 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 2021-10-01 de        0.382      [0.382] 2021-09-30    2021-10-07 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 102 more rows</span></span>
<span class="r-in"><span><span class="co"># See `vignette("backtesting", package="epipredict")` for a full walkthrough</span></span></span>
<span class="r-in"><span><span class="co"># on backtesting forecasters, including plots, etc.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># --- Advanced: ---</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `epix_slide` with `all_versions=FALSE` (the default) applies a</span></span></span>
<span class="r-in"><span><span class="co"># version-unaware computation to several versions of the data. We can also</span></span></span>
<span class="r-in"><span><span class="co"># use `.all_versions=TRUE` to apply a version-*aware* computation to several</span></span></span>
<span class="r-in"><span><span class="co"># versions of the data, again looking at characteristics of the data passed</span></span></span>
<span class="r-in"><span><span class="co"># to each computation. In this case, each computation should expect an</span></span></span>
<span class="r-in"><span><span class="co"># `epi_archive` containing the relevant version data:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">archive_cases_dv_subset</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">epix_slide</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">gk</span>, <span class="va">rtv</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        versions_start <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">DT</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0L</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>          <span class="st">"NA (0 rows)"</span></span></span>
<span class="r-in"><span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://rdrr.io/r/base/toString.html" class="external-link">toString</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">DT</span><span class="op">$</span><span class="va">version</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">}</span>,</span></span>
<span class="r-in"><span>        versions_end <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">versions_end</span>,</span></span>
<span class="r-in"><span>        time_range <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">DT</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0L</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>          <span class="st">"0 `time_value`s"</span></span></span>
<span class="r-in"><span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s -- %s"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">DT</span><span class="op">$</span><span class="va">time_value</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">DT</span><span class="op">$</span><span class="va">time_value</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">}</span>,</span></span>
<span class="r-in"><span>        n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">DT</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        class1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>      <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    .before <span class="op">=</span> <span class="fl">5</span>, .all_versions <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    .versions <span class="op">=</span> <span class="va">requested_versions</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="co"># Focus on one geo_value so we can better see the columns above:</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">geo_value</span> <span class="op">==</span> <span class="st">"ca"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">geo_value</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 14 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    version    versions_start versions_end time_range                   n class1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 2020-09-02 2020-08-29     2020-09-02   2020-08-28 -- 2020-09-01    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 2020-09-03 2020-08-30     2020-09-03   2020-08-29 -- 2020-09-02    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 2020-09-04 2020-08-31     2020-09-04   2020-08-30 -- 2020-09-03    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 2020-09-05 2020-09-01     2020-09-05   2020-08-31 -- 2020-09-04    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 2020-09-06 2020-09-02     2020-09-06   2020-09-01 -- 2020-09-05    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 2020-09-07 2020-09-03     2020-09-07   2020-09-02 -- 2020-09-06    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 2020-09-08 2020-09-04     2020-09-08   2020-09-03 -- 2020-09-07    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 2020-09-09 2020-09-05     2020-09-09   2020-09-04 -- 2020-09-08    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 2020-09-10 2020-09-06     2020-09-10   2020-09-05 -- 2020-09-09    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 2020-09-11 2020-09-07     2020-09-11   2020-09-06 -- 2020-09-10    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span> 2020-09-12 2020-09-08     2020-09-12   2020-09-07 -- 2020-09-11    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span> 2020-09-13 2020-09-09     2020-09-13   2020-09-08 -- 2020-09-12    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">13</span> 2020-09-14 2020-09-10     2020-09-14   2020-09-09 -- 2020-09-13    11 epi_ar…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">14</span> 2020-09-15 2020-09-11     2020-09-15   2020-09-10 -- 2020-09-14    11 epi_ar…</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p><a href="https://delphi.cmu.edu/about/" class="external-link">About Delphi</a> • <a href="https://delphi.cmu.edu/epidemic-signals/terms-of-use/" class="external-link">Terms of Use</a> • <a href="https://docs.google.com/forms/u/1/d/e/1FAIpQLScqgT1fKZr5VWBfsaSp-DNaN03aV6EoZU4YljIzHJ1Wl_zmtg/viewform" class="external-link">Contact Us</a> • <a href="https://github.com/cmu-delphi/" class="external-link">Delphi GitHub</a> • <a href="https://cmu-delphi.github.io/delphi-epidata/" class="external-link">Epidata API</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>epiprocess</p>
</div>

    </footer></div>





  </body></html>

