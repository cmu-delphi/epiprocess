<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="epiprocess">
<title>Get started with `epiprocess` • epiprocess</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get started with `epiprocess`">
<meta property="og:description" content="epiprocess">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-#C41230"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">epiprocess</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/epiprocess.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/slide.html">Slide a computation over signal values</a>
    <a class="dropdown-item" href="../articles/growth_rate.html">Estimate growth rates in signals</a>
    <a class="dropdown-item" href="../articles/correlation.html">Correlate signals over space and time</a>
    <a class="dropdown-item" href="../articles/aggregation.html">Aggregate signals over space and time</a>
    <a class="dropdown-item" href="../articles/outliers.html">Detect and correct outliers in signals</a>
    <a class="dropdown-item" href="../articles/archive.html">Work with archive objects and data revisions</a>
    <a class="dropdown-item" href="../articles/advanced.html">Advanced sliding with nonstandard outputs</a>
    <a class="dropdown-item" href="../articles/compactify.html">Compactify to remove redundant archive data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/cmu-delphi/epiprocess/tree/main/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Get started with `epiprocess`</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epiprocess/blob/main/vignettes/epiprocess.Rmd" class="external-link"><code>vignettes/epiprocess.Rmd</code></a></small>
      <div class="d-none name"><code>epiprocess.Rmd</code></div>
    </div>

    
    
<p>This package introduces a common data structure for epidemiological
data sets measured over space and time, and offers associated utilities
to perform basic signal processing tasks.</p>
<div class="section level2">
<h2 id="installing">Installing<a class="anchor" aria-label="anchor" href="#installing"></a>
</h2>
<p>This package is not on CRAN yet, so it can be installed using the <a href="https://devtools.r-lib.org" class="external-link"><code>devtools</code></a> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"cmu-delphi/epiprocess"</span>, ref <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></span></code></pre></div>
<p>Building the vignettes, such as this getting started guide, takes a
significant amount of time. They are not included in the package by
default. If you want to include vignettes, then use this modified
command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"cmu-delphi/epiprocess"</span>,</span>
<span>  ref <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  build_vignettes <span class="op">=</span> <span class="cn">TRUE</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-data-into-epi_df-format">Getting data into <code>epi_df</code> format<a class="anchor" aria-label="anchor" href="#getting-data-into-epi_df-format"></a>
</h2>
<p>We’ll start by showing how to get data into
<code><a href="../reference/epi_df.html">epi_df</a></code> format, which
is just a tibble with a bit of special structure, and is the format
assumed by all of the functions in the <code>epiprocess</code> package.
An <code>epi_df</code> object has (at least) the following columns:</p>
<ul>
<li>
<code>geo_value</code>: the geographic value associated with each
row of measurements.</li>
<li>
<code>time_value</code>: the time value associated with each row of
measurements.</li>
</ul>
<p>It can have any number of other columns which can serve as measured
variables, which we also broadly refer to as signal variables. The
documentation for gives more details about this data format.</p>
<p>A data frame or tibble that has <code>geo_value</code> and
<code>time_value</code> columns can be converted into an
<code>epi_df</code> object, using the function <code><a href="../reference/as_epi_df.html">as_epi_df()</a></code>.
As an example, we’ll work with daily cumulative COVID-19 cases from four
U.S. states: CA, FL, NY, and TX, over time span from mid 2020 to early
2022, and we’ll use the <a href="https://github.com/cmu-delphi/epidatr" class="external-link"><code>epidatr</code></a>
package to fetch this data from the <a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast.html" class="external-link">COVIDcast
API</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cmu-delphi.github.io/epidatr/" class="external-link">epidatr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cmu-delphi.github.io/epiprocess/">epiprocess</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://withr.r-lib.org" class="external-link">withr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cmu-delphi.github.io/epidatr/reference/pub_covidcast.html" class="external-link">pub_covidcast</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"jhu-csse"</span>,</span>
<span>  signals <span class="op">=</span> <span class="st">"confirmed_cumulative_num"</span>,</span>
<span>  geo_type <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  time_type <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>  geo_values <span class="op">=</span> <span class="st">"ca,fl,ny,tx"</span>,</span>
<span>  time_values <span class="op">=</span> <span class="fu"><a href="https://cmu-delphi.github.io/epidatr/reference/epirange.html" class="external-link">epirange</a></span><span class="op">(</span><span class="fl">20200301</span>, <span class="fl">20220131</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "geo_value"           "signal"              "source"             </span></span>
<span><span class="co">##  [4] "geo_type"            "time_type"           "time_value"         </span></span>
<span><span class="co">##  [7] "direction"           "issue"               "lag"                </span></span>
<span><span class="co">## [10] "missing_value"       "missing_stderr"      "missing_sample_size"</span></span>
<span><span class="co">## [13] "value"               "stderr"              "sample_size"</span></span></code></pre>
<p>As we can see, a data frame returned by
<code><a href="https://cmu-delphi.github.io/epidatr/reference/pub_covidcast.html" class="external-link">epidatr::pub_covidcast()</a></code> has the columns required for an
<code>epi_df</code> object (along with many others). We can use
<code><a href="../reference/as_epi_df.html">as_epi_df()</a></code>, with specification of some relevant metadata,
to bring the data frame into <code>epi_df</code> format.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_epi_df.html">as_epi_df</a></span><span class="op">(</span><span class="va">cases</span>,</span>
<span>  geo_type <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  time_type <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>  as_of <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cases</span><span class="op">$</span><span class="va">issue</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span>, total_cases <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "epi_df"     "tbl_df"     "tbl"        "data.frame"</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## An `epi_df` x, with metadata:</span></span>
<span><span class="co">## * geo_type  = state</span></span>
<span><span class="co">## * time_type = day</span></span>
<span><span class="co">## * as_of     = 2023-03-10</span></span>
<span><span class="co">## ----------</span></span>
<span><span class="co">## * min time value              = 2020-03-01</span></span>
<span><span class="co">## * max time value              = 2022-01-31</span></span>
<span><span class="co">## * average rows per time value = 4</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## An `epi_df` object, 6 x 3 with metadata:</span></span>
<span><span class="co">## * geo_type  = state</span></span>
<span><span class="co">## * time_type = day</span></span>
<span><span class="co">## * as_of     = 2023-03-10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">##   geo_value time_value total_cases</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> ca        2020-03-01          19</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> fl        2020-03-01           0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> ny        2020-03-01           0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> tx        2020-03-01           0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> ca        2020-03-02          23</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> fl        2020-03-02           1</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">metadata</span></span></code></pre></div>
<pre><code><span><span class="co">## $geo_type</span></span>
<span><span class="co">## [1] "state"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $time_type</span></span>
<span><span class="co">## [1] "day"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $as_of</span></span>
<span><span class="co">## [1] "2023-03-10"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $other_keys</span></span>
<span><span class="co">## character(0)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="some-details-on-metadata">Some details on metadata<a class="anchor" aria-label="anchor" href="#some-details-on-metadata"></a>
</h2>
<p>In general, an <code>epi_df</code> object has the following fields in
its metadata:</p>
<ul>
<li>
<code>geo_type</code>: the type for the geo values.</li>
<li>
<code>time_type</code>: the type for the time values.</li>
<li>
<code>as_of</code>: the time value at which the given data were
available.</li>
</ul>
<p>Metadata for an <code>epi_df</code> object <code>x</code> can be
accessed (and altered) via <code>attributes(x)$metadata</code>. The
first two fields here, <code>geo_type</code> and <code>time_type</code>,
are not currently used by any downstream functions in the
<code>epiprocess</code> package, and serve only as useful bits of
information to convey about the data set at hand. The last field here,
<code>as_of</code>, is one of the most unique aspects of an
<code>epi_df</code> object.</p>
<p>In brief, we can think of an <code>epi_df</code> object as a single
snapshot of a data set that contains the most up-to-date values of some
signals of interest, as of the time specified <code>as_of</code>. For
example, if <code>as_of</code> is January 31, 2022, then the
<code>epi_df</code> object has the most up-to-date version of the data
available as of January 31, 2022. The <code>epiprocess</code> package
also provides a companion data structure called
<code>epi_archive</code>, which stores the full version history of a
given data set. See the <a href="https://cmu-delphi.github.io/epiprocess/articles/archive.html">archive
vignette</a> for more.</p>
<p>If any of the <code>geo_type</code>, <code>time_type</code>, or
<code>as_of</code> arguments are missing in a call to
<code><a href="../reference/as_epi_df.html">as_epi_df()</a></code>, then this function will try to infer them from
the passed object. Usually, <code>geo_type</code> and
<code>time_type</code> can be inferred from the <code>geo_value</code>
and <code>time_value</code> columns, respectively, but inferring the
<code>as_of</code> field is not as easy. See the documentation for
<code><a href="../reference/as_epi_df.html">as_epi_df()</a></code> more details.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_epi_df.html">as_epi_df</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span>, total_cases <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">metadata</span></span></code></pre></div>
<pre><code><span><span class="co">## $geo_type</span></span>
<span><span class="co">## [1] "state"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $time_type</span></span>
<span><span class="co">## [1] "day"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $as_of</span></span>
<span><span class="co">## [1] "2023-03-10"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $other_keys</span></span>
<span><span class="co">## character(0)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="using-additional-key-columns-in-epi_df">Using additional key columns in <code>epi_df</code><a class="anchor" aria-label="anchor" href="#using-additional-key-columns-in-epi_df"></a>
</h2>
<p>In the following examples we will show how to create an
<code>epi_df</code> with additional keys.</p>
<div class="section level3">
<h3 id="converting-a-tsibble-that-has-county-code-as-an-extra-key">Converting a <code>tsibble</code> that has county code as an extra
key<a class="anchor" aria-label="anchor" href="#converting-a-tsibble-that-has-county-code-as-an-extra-key"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  geo_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ca"</span>, <span class="st">"fl"</span>, <span class="st">"pa"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  county_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"06059"</span>, <span class="st">"06061"</span>, <span class="st">"06067"</span>,</span>
<span>    <span class="st">"12111"</span>, <span class="st">"12113"</span>, <span class="st">"12117"</span>,</span>
<span>    <span class="st">"42101"</span>, <span class="st">"42103"</span>, <span class="st">"42105"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  time_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-03"</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"day"</span></span>
<span>  <span class="op">)</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.01</span> <span class="op">*</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_rng_version.html" class="external-link">with_rng_version</a></span><span class="op">(</span><span class="st">"3.0.0"</span>, <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">time_value</span>, key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">county_code</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ex1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_epi_df.html">as_epi_df</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ex1</span>, geo_type <span class="op">=</span> <span class="st">"state"</span>, time_type <span class="op">=</span> <span class="st">"day"</span>, as_of <span class="op">=</span> <span class="st">"2020-06-03"</span><span class="op">)</span></span></code></pre></div>
<p>The metadata now includes <code>county_code</code> as an extra
key.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">ex1</span>, <span class="st">"metadata"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $geo_type</span></span>
<span><span class="co">## [1] "state"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $time_type</span></span>
<span><span class="co">## [1] "day"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $as_of</span></span>
<span><span class="co">## [1] "2020-06-03"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $other_keys</span></span>
<span><span class="co">## [1] "county_code"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="dealing-with-misspecified-column-names">Dealing with misspecified column names<a class="anchor" aria-label="anchor" href="#dealing-with-misspecified-column-names"></a>
</h3>
<p><code>epi_df</code> requires there to be columns
<code>geo_value</code> and <code>time_value</code>, if they do not exist
then <code><a href="../reference/as_epi_df.html">as_epi_df()</a></code> throws an error.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ca"</span>, <span class="st">"fl"</span>, <span class="st">"pa"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="co"># misnamed</span></span>
<span>  pol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"swing"</span>, <span class="st">"swing"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="co"># extra key</span></span>
<span>  reported_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-03"</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"day"</span></span>
<span>  <span class="op">)</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span><span class="op">)</span>, <span class="co"># misnamed</span></span>
<span>  value <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.01</span> <span class="op">*</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_rng_version.html" class="external-link">with_rng_version</a></span><span class="op">(</span><span class="st">"3.0.0"</span>, <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/as_epi_df.html">as_epi_df</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'geo_value' not found</span></span></code></pre>
<p>The columns can be renamed to match <code>epi_df</code> format. In
the example below, notice there is also an additional key
<code>pol</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ca"</span>, <span class="st">"fl"</span>, <span class="st">"pa"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="co"># misnamed</span></span>
<span>  pol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"swing"</span>, <span class="st">"swing"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="co"># extra key</span></span>
<span>  reported_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-03"</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"day"</span></span>
<span>  <span class="op">)</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span>, <span class="co"># misnamed</span></span>
<span>  value <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.01</span> <span class="op">*</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_rng_version.html" class="external-link">with_rng_version</a></span><span class="op">(</span><span class="st">"3.0.0"</span>, <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ex2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   state   pol reported_date value</span></span>
<span><span class="co">## 1    ca  blue    2020-06-01  1.09</span></span>
<span><span class="co">## 2    ca  blue    2020-06-02  2.09</span></span>
<span><span class="co">## 3    ca  blue    2020-06-03  3.09</span></span>
<span><span class="co">## 4    fl swing    2020-06-01  4.09</span></span>
<span><span class="co">## 5    fl swing    2020-06-02  5.09</span></span>
<span><span class="co">## 6    fl swing    2020-06-03  6.09</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex2</span> <span class="op">&lt;-</span> <span class="va">ex2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>geo_value <span class="op">=</span> <span class="va">state</span>, time_value <span class="op">=</span> <span class="va">reported_date</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_epi_df.html">as_epi_df</a></span><span class="op">(</span></span>
<span>    geo_type <span class="op">=</span> <span class="st">"state"</span>, as_of <span class="op">=</span> <span class="st">"2020-06-03"</span>,</span>
<span>    additional_metadata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>other_keys <span class="op">=</span> <span class="st">"pol"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">ex2</span>, <span class="st">"metadata"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $geo_type</span></span>
<span><span class="co">## [1] "state"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $time_type</span></span>
<span><span class="co">## [1] "day"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $as_of</span></span>
<span><span class="co">## [1] "2020-06-03"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $other_keys</span></span>
<span><span class="co">## [1] "pol"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="adding-additional-keys-to-an-epi_df-object">Adding additional keys to an <code>epi_df</code> object<a class="anchor" aria-label="anchor" href="#adding-additional-keys-to-an-epi_df-object"></a>
</h3>
<p>In the above examples, all the keys are added to objects that are not
<code>epi_df</code> objects. We illustrate how to add keys to an
<code>epi_df</code> object.</p>
<p>We use a toy data set included in <code>epiprocess</code> prepared
using the <code>covidcast</code> library and are filtering to a single
state for simplicity.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex3</span> <span class="op">&lt;-</span> <span class="va">jhu_csse_county_level_subset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time_value</span> <span class="op">&gt;</span> <span class="st">"2021-12-01"</span>, <span class="va">state_name</span> <span class="op">==</span> <span class="st">"Massachusetts"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">ex3</span>, <span class="st">"metadata"</span><span class="op">)</span> <span class="co"># geo_type is county currently</span></span></code></pre></div>
<pre><code><span><span class="co">## $geo_type</span></span>
<span><span class="co">## [1] "county"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $time_type</span></span>
<span><span class="co">## [1] "day"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $as_of</span></span>
<span><span class="co">## [1] "2022-05-23 21:35:45 UTC"</span></span></code></pre>
<p>Now we add <code>state</code> (MA) and <code>pol</code> as new
columns to the data and as new keys to the metadata. Reminder that lower
case state name abbreviations are what we would expect if this were a
<code>geo_value</code> column.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex3</span> <span class="op">&lt;-</span> <span class="va">ex3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># needed to add the additional metadata</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="st">"MA"</span><span class="op">)</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>    pol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"swing"</span>, <span class="st">"swing"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_epi_df.html">as_epi_df</a></span><span class="op">(</span>additional_metadata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>other_keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"state"</span>, <span class="st">"pol"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">ex3</span>, <span class="st">"metadata"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $geo_type</span></span>
<span><span class="co">## [1] "county"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $time_type</span></span>
<span><span class="co">## [1] "day"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $as_of</span></span>
<span><span class="co">## [1] "2024-01-26 17:56:18 UTC"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $other_keys</span></span>
<span><span class="co">## [1] "state" "pol"</span></span></code></pre>
<p>Note that the two additional keys we added, <code>state</code> and
<code>pol</code>, are specified as a character vector in the
<code>other_keys</code> component of the
<code>additional_metadata</code> list. They must be specified in this
manner so that downstream actions on the <code>epi_df</code>, like model
fitting and prediction, can recognize and use these keys.</p>
<p>Currently <code>other_keys</code> metadata in <code>epi_df</code>
doesn’t impact <code><a href="../reference/epi_slide.html">epi_slide()</a></code>, contrary to
<code>other_keys</code> in <code>as_epi_archive</code> which affects how
the update data is interpreted.</p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-epi_df-objects-downstream">Working with <code>epi_df</code> objects downstream<a class="anchor" aria-label="anchor" href="#working-with-epi_df-objects-downstream"></a>
</h2>
<p>Data in <code>epi_df</code> format should be easy to work with
downstream, since it is a very standard tabular data format; in the
other vignettes, we’ll walk through some basic signal processing tasks
using functions provided in the <code>epiprocess</code> package. Of
course, we can also write custom code for other downstream uses, like
plotting, which is pretty easy to do <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_value</span>, y <span class="op">=</span> <span class="va">total_cases</span>, color <span class="op">=</span> <span class="va">geo_value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>minor_breaks <span class="op">=</span> <span class="st">"month"</span>, date_labels <span class="op">=</span> <span class="st">"%b %y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Cumulative COVID-19 cases"</span>, color <span class="op">=</span> <span class="st">"State"</span><span class="op">)</span></span></code></pre></div>
<p><img src="epiprocess_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>As a last couple examples, we’ll look at some more data sets just to
show how we might get them into <code>epi_df</code> format. Data on
daily new (not cumulative) SARS cases in Canada in 2003, from the <a href="https://github.com/reconverse/outbreaks" class="external-link">outbreaks</a>
package:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">outbreaks</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/outbreaks/man/sars_canada_2003.html" class="external-link">sars_canada_2003</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>geo_value <span class="op">=</span> <span class="st">"ca"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, time_value <span class="op">=</span> <span class="va">date</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"cases"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_epi_df.html">as_epi_df</a></span><span class="op">(</span>geo_type <span class="op">=</span> <span class="st">"nation"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## An `epi_df` object, 6 x 6 with metadata:</span></span>
<span><span class="co">## * geo_type  = nation</span></span>
<span><span class="co">## * time_type = day</span></span>
<span><span class="co">## * as_of     = 2024-01-26 17:56:19.205335</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">##   geo_value time_value cases_travel cases_household cases_healthcare cases_other</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> ca        2003-02-23            1               0                0           0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> ca        2003-02-24            0               0                0           0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> ca        2003-02-25            0               0                0           0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> ca        2003-02-26            0               1                0           0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> ca        2003-02-27            0               0                0           0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> ca        2003-02-28            1               0                0           0</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"cases"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"type"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">type</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">yrange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">time_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_value</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>minor_breaks <span class="op">=</span> <span class="st">"month"</span>, date_labels <span class="op">=</span> <span class="st">"%b %y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">yrange</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">:</span><span class="va">yrange</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"SARS cases in Canada"</span>, fill <span class="op">=</span> <span class="st">"Type"</span><span class="op">)</span></span></code></pre></div>
<p><img src="epiprocess_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>Data on new cases of Ebola in Sierra Leone in 2014, from the same
package:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">outbreaks</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/outbreaks/man/ebola_sierraleone_2014.html" class="external-link">ebola_sierraleone_2014</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">status</span> <span class="op">==</span> <span class="st">"confirmed"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    province <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">district</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Kailahun"</span>, <span class="st">"Kenema"</span>, <span class="st">"Kono"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Eastern"</span>,</span>
<span>      <span class="va">district</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Bombali"</span>, <span class="st">"Kambia"</span>, <span class="st">"Koinadugu"</span>,</span>
<span>        <span class="st">"Port Loko"</span>, <span class="st">"Tonkolili"</span></span>
<span>      <span class="op">)</span> <span class="op">~</span> <span class="st">"Northern"</span>,</span>
<span>      <span class="va">district</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Bo"</span>, <span class="st">"Bonthe"</span>, <span class="st">"Moyamba"</span>, <span class="st">"Pujehun"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Sourthern"</span>,</span>
<span>      <span class="va">district</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Western Rural"</span>, <span class="st">"Western Urban"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Western"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    geo_value <span class="op">=</span> <span class="va">province</span>,</span>
<span>    time_value <span class="op">=</span> <span class="va">date_of_onset</span>,</span>
<span>    <span class="va">cases</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cases</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_epi_df.html">as_epi_df</a></span><span class="op">(</span>geo_type <span class="op">=</span> <span class="st">"province"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_value</span>, y <span class="op">=</span> <span class="va">cases</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">geo_value</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">geo_value</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>minor_breaks <span class="op">=</span> <span class="st">"month"</span>, date_labels <span class="op">=</span> <span class="st">"%b %y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Confirmed cases of Ebola in Sierra Leone"</span><span class="op">)</span></span></code></pre></div>
<p><img src="epiprocess_files/figure-html/unnamed-chunk-14-1.png" width="864"></p>
</div>
<div class="section level2">
<h2 id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a>
</h2>
<p>This document contains a dataset that is a modified part of the <a href="https://github.com/CSSEGISandData/COVID-19" class="external-link">COVID-19 Data
Repository by the Center for Systems Science and Engineering (CSSE) at
Johns Hopkins University</a> as <a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast-signals/jhu-csse.html" class="external-link">republished
in the COVIDcast Epidata API</a>. This data set is licensed under the
terms of the <a href="https://creativecommons.org/licenses/by/4.0/" class="external-link">Creative Commons
Attribution 4.0 International license</a> by the Johns Hopkins
University on behalf of its Center for Systems Science in Engineering.
Copyright Johns Hopkins University 2020.</p>
<p><a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast-signals/jhu-csse.html" class="external-link">From
the COVIDcast Epidata API</a>: These signals are taken directly from the
JHU CSSE <a href="https://github.com/CSSEGISandData/COVID-19" class="external-link">COVID-19
GitHub repository</a> without changes.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Logan Brooks, Daniel McDonald, Evan Ray, Ryan Tibshirani.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
