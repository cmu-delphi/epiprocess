<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="epiprocess">
<title>Aggregate signals over space and time • epiprocess</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Aggregate signals over space and time">
<meta property="og:description" content="epiprocess">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">epiprocess</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/epiprocess.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/slide.html">Slide a computation over signal values</a>
    <a class="dropdown-item" href="../articles/growth_rate.html">Estimate growth rates in signals</a>
    <a class="dropdown-item" href="../articles/correlation.html">Correlate signals over space and time</a>
    <a class="dropdown-item" href="../articles/aggregation.html">Aggregate signals over space and time</a>
    <a class="dropdown-item" href="../articles/outliers.html">Detect and correct outliers in signals</a>
    <a class="dropdown-item" href="../articles/archive.html">Work with archive objects and data revisions</a>
    <a class="dropdown-item" href="../articles/advanced.html">Advanced sliding with nonstandard outputs</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/cmu-delphi/epiprocess/tree/main/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="aggregation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Aggregate signals over space and time</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epiprocess/blob/main/vignettes/aggregation.Rmd" class="external-link"><code>vignettes/aggregation.Rmd</code></a></small>
      <div class="d-none name"><code>aggregation.Rmd</code></div>
    </div>

    
    
<p>Aggregation, both time-wise and geo-wise, are common tasks when working with epidemiological data sets. This vignette demonstrates how to carry out these kinds of tasks with <code>epi_df</code> objects. We’ll work with county-level reported COVID-19 cases in MA and VT.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cmu-delphi/delphi-epidata-r" class="external-link">delphi.epidata</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cmu-delphi.github.io/covidcast/covidcastR/" class="external-link">covidcast</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cmu-delphi.github.io/epiprocess/">epiprocess</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>

<span class="co"># Use covidcast::county_census to get the county and state names</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">covidcast</span><span class="fu">::</span><span class="va"><a href="https://cmu-delphi.github.io/covidcast/covidcastR/reference/county_census.html" class="external-link">county_census</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">STNAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Massachusetts"</span>, <span class="st">"Vermont"</span><span class="op">)</span>, <span class="va">STNAME</span> <span class="op">!=</span> <span class="va">CTYNAME</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>geo_value <span class="op">=</span> <span class="va">FIPS</span>, county_name <span class="op">=</span> <span class="va">CTYNAME</span>, state_name <span class="op">=</span> <span class="va">STNAME</span><span class="op">)</span>

<span class="co"># Fetch only counties from Massachusetts and Vermont, then append names columns as well</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/delphi.epidata/man/covidcast.html" class="external-link">covidcast</a></span><span class="op">(</span>
  data_source <span class="op">=</span> <span class="st">"jhu-csse"</span>,
  signals <span class="op">=</span> <span class="st">"confirmed_incidence_num"</span>,
  time_type <span class="op">=</span> <span class="st">"day"</span>,
  geo_type <span class="op">=</span> <span class="st">"county"</span>,
  time_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/delphi.epidata/man/epirange.html" class="external-link">epirange</a></span><span class="op">(</span><span class="fl">20200601</span>, <span class="fl">20211231</span><span class="op">)</span>,
  geo_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">geo_value</span>, collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/delphi.epidata/man/fetch_tbl.html" class="external-link">fetch_tbl</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span>, cases <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">y</span>, by <span class="op">=</span> <span class="st">"geo_value"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/as_epi_df.html">as_epi_df</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The data contains 16,212 rows and 5 columns.</p>
<div class="section level2">
<h2 id="converting-to-tsibble-format">Converting to <code>tsibble</code> format<a class="anchor" aria-label="anchor" href="#converting-to-tsibble-format"></a>
</h2>
<p>For manipulating and wrangling time series data, the <a href="https://tsibble.tidyverts.org/index.html" class="external-link"><code>tsibble</code></a> already provides a whole bunch of useful tools. A tsibble object (formerly, of class <code>tbl_ts</code>) is basically a tibble (data frame) but with two specially-marked columns: an <strong>index</strong> column representing the time variable (defining an order from past to present), and a <strong>key</strong> column identifying a unique observational unit for each time point. In fact, the key can be made up of any number of columns, not just a single one.</p>
<p>In an <code>epi_df</code> object, the index variable is <code>time_value</code>, and the key variable is typically <code>geo_value</code> (though this need not always be the case: for example, if we have an age group variable as another column, then this could serve as a second key variable). The <code>epiprocess</code> package thus provides an implementation of <code><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble()</a></code> for <code>epi_df</code> objects, which sets these variables according to these defaults.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tsibble.tidyverts.org" class="external-link">tsibble</a></span><span class="op">)</span>

<span class="va">xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tsibble: 6 x 5 [1D]</span></span>
<span class="co">## <span style="color: #949494;"># Key:       geo_value [1]</span></span>
<span class="co">##   geo_value time_value cases county_name       state_name   </span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span>
<span class="co">## <span style="color: #BCBCBC;">1</span> 25001     2020-06-01     4 Barnstable County Massachusetts</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> 25001     2020-06-02     6 Barnstable County Massachusetts</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> 25001     2020-06-03     5 Barnstable County Massachusetts</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> 25001     2020-06-04     8 Barnstable County Massachusetts</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> 25001     2020-06-05     3 Barnstable County Massachusetts</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> 25001     2020-06-06     4 Barnstable County Massachusetts</span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tsibble.tidyverts.org/reference/key.html" class="external-link">key</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [[1]]</span>
<span class="co">## geo_value</span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tsibble.tidyverts.org/reference/index-rd.html" class="external-link">index</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## time_value</span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tsibble.tidyverts.org/reference/regular.html" class="external-link">interval</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## &lt;interval[1]&gt;</span>
<span class="co">## [1] 1D</span></code></pre>
<p>We can also set the key variable(s) directly in a call to <code><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble()</a></code>. Similar to SQL keys, if the key does not uniquely identify each time point (that is, the key and index together do not not uniquely identify each row), then <code><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble()</a></code> throws an error:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="va">x</span>, key <span class="op">=</span> <span class="st">"county_name"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `validate_tsibble()`:</span></span>
<span class="co">## <span style="color: #BBBB00;">!</span> A valid tsibble must have distinct rows identified by key and index.</span>
<span class="co">## <span style="color: #0000BB;">ℹ</span> Please use `duplicates()` to check the duplicated rows.</span></code></pre>
<p>As we can see, there are duplicate county names between Massachusetts and Vermont, which caused the error.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/duplicates.html" class="external-link">duplicates</a></span><span class="op">(</span><span class="va">x</span>, key <span class="op">=</span> <span class="st">"county_name"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 6 × 5</span></span>
<span class="co">##   geo_value time_value cases county_name     state_name   </span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span>
<span class="co">## <span style="color: #BCBCBC;">1</span> 25009     2020-06-01    63 Essex County    Massachusetts</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> 25011     2020-06-01     0 Franklin County Massachusetts</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> 50009     2020-06-01     0 Essex County    Vermont      </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> 50011     2020-06-01     0 Franklin County Vermont      </span>
<span class="co">## <span style="color: #BCBCBC;">5</span> 25009     2020-06-02    74 Essex County    Massachusetts</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> 25011     2020-06-02     0 Franklin County Massachusetts</span></code></pre>
<p>Keying by both county name and state name, however, does work:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="va">x</span>, key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"county_name"</span>, <span class="st">"state_name"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tsibble: 6 x 5 [1D]</span></span>
<span class="co">## <span style="color: #949494;"># Key:       county_name, state_name [1]</span></span>
<span class="co">##   geo_value time_value cases county_name    state_name</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span>
<span class="co">## <span style="color: #BCBCBC;">1</span> 50001     2020-06-01     0 Addison County Vermont   </span>
<span class="co">## <span style="color: #BCBCBC;">2</span> 50001     2020-06-02     0 Addison County Vermont   </span>
<span class="co">## <span style="color: #BCBCBC;">3</span> 50001     2020-06-03     0 Addison County Vermont   </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> 50001     2020-06-04     0 Addison County Vermont   </span>
<span class="co">## <span style="color: #BCBCBC;">5</span> 50001     2020-06-05     0 Addison County Vermont   </span>
<span class="co">## <span style="color: #BCBCBC;">6</span> 50001     2020-06-06     1 Addison County Vermont</span></code></pre>
</div>
<div class="section level2">
<h2 id="detecting-and-filling-time-gaps">Detecting and filling time gaps<a class="anchor" aria-label="anchor" href="#detecting-and-filling-time-gaps"></a>
</h2>
<p>One of the major advantages of the <code>tsibble</code> package is its ability to handle <strong>implicit gaps</strong> in time series data. In other words, it can infer what time scale we’re interested in (say, daily data), and detect apparent gaps (say, when values are reported on January 1 and 3 but not January 2). We can subsequently use functionality to make these missing entries explicit, which will generally help avoid bugs in further downstream data processing tasks.</p>
<p>Let’s first remove certain dates from our data set to create gaps:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># First make geo value more readable for tables, plots, etc.</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>            
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>geo_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">county_name</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">county_name</span><span class="op">)</span> <span class="op">-</span> <span class="fl">7</span><span class="op">)</span>,
      <span class="fu"><a href="https://cmu-delphi.github.io/covidcast/covidcastR/reference/name_to_abbr.html" class="external-link">name_to_abbr</a></span><span class="op">(</span><span class="va">state_name</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span>, <span class="va">cases</span><span class="op">)</span>

<span class="va">xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cases</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span> </code></pre></div>
<p>The functions <code><a href="https://tsibble.tidyverts.org/reference/has_gaps.html" class="external-link">has_gaps()</a></code>, <code><a href="https://tsibble.tidyverts.org/reference/scan_gaps.html" class="external-link">scan_gaps()</a></code>, <code><a href="https://tsibble.tidyverts.org/reference/count_gaps.html" class="external-link">count_gaps()</a></code> in the <code>tsibble</code> package each provide useful summaries, in slightly different formats.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/has_gaps.html" class="external-link">has_gaps</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span>
<span class="co">##   geo_value      .gaps</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> Addison, VT    TRUE </span>
<span class="co">## <span style="color: #BCBCBC;">2</span> Barnstable, MA TRUE </span>
<span class="co">## <span style="color: #BCBCBC;">3</span> Bennington, VT TRUE </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> Berkshire, MA  TRUE </span>
<span class="co">## <span style="color: #BCBCBC;">5</span> Bristol, MA    TRUE </span>
<span class="co">## <span style="color: #BCBCBC;">6</span> Caledonia, VT  TRUE</span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/scan_gaps.html" class="external-link">scan_gaps</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tsibble: 6 x 2 [1D]</span></span>
<span class="co">## <span style="color: #949494;"># Key:       geo_value [1]</span></span>
<span class="co">##   geo_value   time_value</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span>
<span class="co">## <span style="color: #BCBCBC;">1</span> Addison, VT 2020-08-28</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> Addison, VT 2020-08-29</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> Addison, VT 2020-08-30</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> Addison, VT 2020-08-31</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> Addison, VT 2020-09-01</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> Addison, VT 2020-09-02</span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/count_gaps.html" class="external-link">count_gaps</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 6 × 4</span></span>
<span class="co">##   geo_value   .from      .to           .n</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> Addison, VT 2020-08-28 2020-10-04    38</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> Addison, VT 2020-10-06 2020-10-23    18</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> Addison, VT 2020-10-25 2020-11-04    11</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> Addison, VT 2020-11-06 2020-11-10     5</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> Addison, VT 2020-11-14 2020-11-18     5</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> Addison, VT 2020-11-20 2020-11-20     1</span></code></pre>
<p>We can also visualize the patterns of missingness:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/count_gaps.html" class="external-link">count_gaps</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span><span class="op">)</span>,
           color <span class="op">=</span> <span class="va">geo_value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.from</span>, ymax <span class="op">=</span> <span class="va">.to</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.from</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.to</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"County"</span>, y <span class="op">=</span> <span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<p><img src="aggregation_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Using the <code><a href="https://tsibble.tidyverts.org/reference/fill_gaps.html" class="external-link">fill_gaps()</a></code> function from <code>tsibble</code>, we can replace all gaps by an explicit value. The default is <code>NA</code>, but in the current case, where missingness is not at random but rather represents a small value that was censored (only a hypothetical with COVID-19 reports, but certainly a real phenomenon that occurs in other signals), it is better to replace it by zero, which is what we do here. (Other approaches, such as LOCF: last-observation-carried-forward, could be accomplished by first filling with <code>NA</code> values and then following up with a second call to <code><a href="https://tidyr.tidyverse.org/reference/fill.html" class="external-link">tidyr::fill()</a></code>.)</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tsibble.tidyverts.org/reference/fill_gaps.html" class="external-link">fill_gaps</a></span><span class="op">(</span><span class="va">xt</span>, cases <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tsibble: 6 x 3 [1D]</span></span>
<span class="co">## <span style="color: #949494;"># Key:       geo_value [1]</span></span>
<span class="co">##   geo_value   time_value cases</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> Addison, VT 2020-08-27     3</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> Addison, VT 2020-08-28     0</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> Addison, VT 2020-08-29     0</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> Addison, VT 2020-08-30     0</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> Addison, VT 2020-08-31     0</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> Addison, VT 2020-09-01     0</span></code></pre>
<p>Note that the time series for Addison, VT only starts on August 27, 2020, even though the original (uncensored) data set itself was drawn from a period that went back to June 6, 2020. By setting <code>.full = TRUE</code>, we can at zero-fill over the entire span of the observed (censored) data.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xt_filled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tsibble.tidyverts.org/reference/fill_gaps.html" class="external-link">fill_gaps</a></span><span class="op">(</span><span class="va">xt</span>, cases <span class="op">=</span> <span class="fl">0</span>, .full <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> 
  
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xt_filled</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tsibble: 6 x 3 [1D]</span></span>
<span class="co">## <span style="color: #949494;"># Key:       geo_value [1]</span></span>
<span class="co">##   geo_value   time_value cases</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> Addison, VT 2020-06-01     0</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> Addison, VT 2020-06-02     0</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> Addison, VT 2020-06-03     0</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> Addison, VT 2020-06-04     0</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> Addison, VT 2020-06-05     0</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> Addison, VT 2020-06-06     0</span></code></pre>
<p>Explicit imputation for missingness (zero-filling in our case) can be important for protecting against bugs in all sorts of downstream tasks. For example, even something as simple as a 7-day trailing average is complicated by missingness. The function <code><a href="../reference/epi_slide.html">epi_slide()</a></code> looks for all rows within a window of 7 days anchored on the right at the reference time point (when <code>n = 7</code> and <code>align = "right"</code>). But when some days in a given week are missing because they were censored because they had small case counts, taking an average of the observed case counts can be misleading and is unintentionally biased upwards. Meanwhile, running <code><a href="../reference/epi_slide.html">epi_slide()</a></code> on the zero-filled data brings these trailing averages (appropriately) downwards, as we can see inspecting Plymouth, MA around July 1, 2021.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xt</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/as_epi_df.html">as_epi_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/epi_slide.html">epi_slide</a></span><span class="op">(</span>cases_7dav <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">geo_value</span> <span class="op">==</span> <span class="st">"Plymouth, MA"</span>,
         <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">time_value</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-07-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## An `epi_df` object, with metadata:</span>
<span class="co">## * geo_type  = nation</span>
<span class="co">## * time_type = day</span>
<span class="co">## * as_of     = 2022-06-22 16:14:53</span>
<span class="co">## </span>
<span class="co">## <span style="color: #949494;"># A tibble: 4 × 4</span></span>
<span class="co">## <span style="color: #949494;"># Groups:   geo_value [1]</span></span>
<span class="co">##   geo_value    time_value cases cases_7dav</span>
<span class="co">## <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> Plymouth, MA 2021-06-28     3       4.25</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> Plymouth, MA 2021-06-30     7       5   </span>
<span class="co">## <span style="color: #BCBCBC;">3</span> Plymouth, MA 2021-07-01     6       5   </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> Plymouth, MA 2021-07-02     6       5.2</span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xt_filled</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/as_epi_df.html">as_epi_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/epi_slide.html">epi_slide</a></span><span class="op">(</span>cases_7dav <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">geo_value</span> <span class="op">==</span> <span class="st">"Plymouth, MA"</span>,
         <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">time_value</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-07-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## An `epi_df` object, with metadata:</span>
<span class="co">## * geo_type  = nation</span>
<span class="co">## * time_type = day</span>
<span class="co">## * as_of     = 2022-06-22 16:14:54</span>
<span class="co">## </span>
<span class="co">## <span style="color: #949494;"># A tibble: 7 × 4</span></span>
<span class="co">## <span style="color: #949494;"># Groups:   geo_value [1]</span></span>
<span class="co">##   geo_value    time_value cases cases_7dav</span>
<span class="co">## <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> Plymouth, MA 2021-06-28     3       2.43</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> Plymouth, MA 2021-06-29     0       2.43</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> Plymouth, MA 2021-06-30     7       2.86</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> Plymouth, MA 2021-07-01     6       2.86</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> Plymouth, MA 2021-07-02     6       3.71</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> Plymouth, MA 2021-07-03     0       3.71</span>
<span class="co">## <span style="color: #BCBCBC;">7</span> Plymouth, MA 2021-07-04     0       3.14</span></code></pre>
</div>
<div class="section level2">
<h2 id="aggregate-to-different-time-scales">Aggregate to different time scales<a class="anchor" aria-label="anchor" href="#aggregate-to-different-time-scales"></a>
</h2>
<p>Continuing on with useful <code>tsibble</code> functionality, we can aggregate to different time scales using <code><a href="https://tsibble.tidyverts.org/reference/index-by.html" class="external-link">index_by()</a></code> from <code>tsibble</code>, which modifies the index variable in the given object by applying a suitable time-coarsening transformation (say, moving from days to weeks, or weeks to months, and so on). The most common use case would be to follow up with a call to a <code>dplyr</code> verb like <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize()</a></code> in order to perform some kind of aggregation of our measured variables over the new index variable.</p>
<p>Below, we use the functions <code><a href="https://tsibble.tidyverts.org/reference/year-week.html" class="external-link">yearweek()</a></code> and <code><a href="https://tsibble.tidyverts.org/reference/year-month.html" class="external-link">yearmonth()</a></code> that are provided in the <code>tsibble</code> package in order to aggregate to weekly and monthly resolutions. In the former call, we set <code>week_start = 7</code> to coincide with the CDC definition of an epiweek (epidemiological week).</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Aggregate to weekly</span>
<span class="va">xt_filled_week</span> <span class="op">&lt;-</span> <span class="va">xt_filled</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tsibble.tidyverts.org/reference/index-by.html" class="external-link">index_by</a></span><span class="op">(</span>epiweek <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html" class="external-link">yearweek</a></span><span class="op">(</span><span class="va">.</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cases</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xt_filled_week</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tsibble: 6 x 3 [1W]</span></span>
<span class="co">## <span style="color: #949494;"># Key:       geo_value [1]</span></span>
<span class="co">##   geo_value    epiweek cases</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;week&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> Addison, VT 2020 W23     0</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> Addison, VT 2020 W24     0</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> Addison, VT 2020 W25     0</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> Addison, VT 2020 W26     0</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> Addison, VT 2020 W27     0</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> Addison, VT 2020 W28     0</span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Aggregate to monthly</span>
<span class="va">xt_filled_month</span> <span class="op">&lt;-</span> <span class="va">xt_filled_week</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tsibble.tidyverts.org/reference/index-by.html" class="external-link">index_by</a></span><span class="op">(</span>month <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html" class="external-link">yearmonth</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cases</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xt_filled_month</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tsibble: 6 x 3 [1M]</span></span>
<span class="co">## <span style="color: #949494;"># Key:       geo_value [1]</span></span>
<span class="co">##   geo_value      month cases</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;mth&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> Addison, VT 2020 May     0</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> Addison, VT 2020 Jun     0</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> Addison, VT 2020 Jul     0</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> Addison, VT 2020 Aug     3</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> Addison, VT 2020 Sep     0</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> Addison, VT 2020 Oct    29</span></code></pre>
</div>
<div class="section level2">
<h2 id="geographic-aggregation">Geographic aggregation<a class="anchor" aria-label="anchor" href="#geographic-aggregation"></a>
</h2>
<p>TODO</p>
</div>
<div class="section level2">
<h2 id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a>
</h2>
<p>This document contains dataset that is a modified part of the <a href="https://github.com/CSSEGISandData/COVID-19" class="external-link">COVID-19 Data Repository by the Center for Systems Science and Engineering (CSSE) at Johns Hopkins University</a> as <a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast-signals/jhu-csse.html" class="external-link">republished in the COVIDcast Epidata API</a>. This data set is licensed under the terms of the <a href="https://creativecommons.org/licenses/by/4.0/" class="external-link">Creative Commons Attribution 4.0 International license</a> by the Johns Hopkins University on behalf of its Center for Systems Science in Engineering. Copyright Johns Hopkins University 2020.</p>
<p><a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast-signals/jhu-csse.html" class="external-link">From the COVIDcast Epidata API</a>: These signals are taken directly from the JHU CSSE <a href="https://github.com/CSSEGISandData/COVID-19" class="external-link">COVID-19 GitHub repository</a> without changes.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Logan Brooks, Daniel McDonald, Evan Ray, Ryan Tibshirani.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
